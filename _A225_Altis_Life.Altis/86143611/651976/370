for"_i"from 0 to 1 step 0 do{if!(_cursorObject getVariable["ga_firePriority",true]) exitWith{["Even though this building is on fire, your chief has forced you to turn of your hose because this is not the building you are supposed to be extinguishing"]spawn life_fnc_handleMessage;};if((getPosATL player) distance2D _startPos>=25) exitWith{["Your hose has automatically shut off, because you were moving!"]spawn life_fnc_handleMessage;};if!(alive player) exitWith{["Your hose has automatically shut off, because you died!"]spawn life_fnc_handleMessage;};if(life_firehoseProgress>=100) exitWith{_success=true;life_firehoseProgress=100;player setVariable["ga_hoseComplete",true,2];};if!(player getVariable["ga_hoseOn",false]) exitWith{["Your hose has been stopped!"]spawn life_fnc_handleMessage;};if!([getPosATL player,getDir player,65,getPosATL _cursorObject]call BIS_fnc_inAngleSector) exitWith{["You must aim at the burning building!"]spawn life_fnc_handleMessage;};if(life_firehoseGallons<=0) exitWith{["You have no water left in your hose, refill at your nearest AFD tempest fuel!"]spawn life_fnc_handleMessage;life_firehoseGallons=0;};_progress progressSetPosition(life_firehoseProgress/100);_pgText ctrlSetText format["%3 (%1%2) Gallons: %4",round life_firehoseProgress,"%",_text,life_firehoseGallons];life_firehoseProgress=life_firehoseProgress+1;life_firehoseGallons=life_firehoseGallons-2;uiSleep 2;};5 cutText["","PLAIN"];if!(_success) exitWith{player setVariable["ga_hoseOn",false,true]};player setVariable["ga_hoseOn",false,true];if(life_firehoseProgress>=100) then{player setVariable["ga_hoseComplete",true,2];};["You have finished contributing to taking out the fire. Wait for other medical personel to finish!"]spawn life_fnc_handleMessage;life_firehoseProgress=100;}else{["You have turned off your fire hose!"]spawn life_fnc_handleMessage;player setVariable["ga_hoseOn",false,true];};};case("hoseEffects"):{_fireData params[["_fireFighter",objNull,[objNull]]];private _waterPressure=5;private _initalWaterSize=0.25;private _finalWaterSize=5;private _localHoseExit="Item_Butane_canister"createVehicleLocal[0,0,0];_localHoseExit hideObject true;_localHoseExit attachTo[_fireFighter,[-0.178,0.275,0.941]];_localHoseExit setVectorDirAndUp[[0,1,0],[0,0,1]];waitUntil{uiSleep 0.1;(_fireFighter getVariable["ga_hoseOn",false])};[_fireFighter,_localHoseExit]spawn{params["_fireFighter","_localHoseExit"];while{(_fireFighter getVariable["ga_hoseOn",false])}do{_localHoseExit say3D["medicFireHose",25];uiSleep 3.9;};};while{uiSleep 0.0375;alive _fireFighter&&!isNull _fireFighter&&(_fireFighter getVariable["ga_hoseOn",false])}do{drop[["\A3\data_f\cl_water",1,0,1],"","Billboard",0,3,[0,0,0],[5,10,7],0,1050,15,0,[_initalWaterSize,_finalWaterSize],[[0.80,0.90,1,0.5],[0.80,0.90,1,0.5]],[999],0,0,"","",_localHoseExit,-80];};deleteVehicle _localHoseExit;};case("fillHose"):{if(life_firehoseGallons>=100) exitWith{["You already have 100 gallons in your hose!"]spawn life_fnc_handleMessage;};if(life_action_in_use) exitWith{};disableSerialization;5 cutRsc["life_progress","PLAIN"];private _ui=uiNamespace getVariable"life_progress";private _progress=_ui displayCtrl 38201;private _pgText=_ui displayCtrl 38202;private _text=format["%1%2...","Refilling Fire Hose"];_pgText ctrlSetText format["%2(%1)...","%",_text];_progress progressSetPosition 0.01;_success=false;private _startPos=getPos player;life_action_in_use=true;["Acts_carFixingWheel",30]spawn life_fnc_handleAnim;private _toSend=(allPlayers-[allDeadMen]) select{(_x distance player)<=20};[[life_axeObject,"medicFireHoseFill"],"life_fnc_playSound",_toSend]spawn life_fnc_MP;[]spawn{uiSleep 3;while{life_action_in_use}do{life_axeObject say3D["medicFireHoseFill",15];uiSleep 3;};};for"_i"from 0 to 1 step 0 do{if(life_firehoseGallons>=100) exitWith{["Your hose is full with over 100 gallons of water!"]spawn life_fnc_handleMessage;};if((getPosATL player) distance2D _startPos>=5) exitWith{["Your re-filling has abruptly stopped, because you were moving!"]spawn life_fnc_handleMessage;};if!(alive player) exitWith{};if(life_firehoseGallons>=100) exitWith{_success=true;};if!(life_action_in_use) exitWith{};_progress progressSetPosition(life_firehoseGallons/100);_pgText ctrlSetText format["%3 (%1 Gallons)",round life_firehoseGallons,"%",_text];life_firehoseGallons=life_firehoseGallons+1;uiSleep 0.5;};player switchMove"";5 cutText["","PLAIN"];[]spawn life_fnc_handleAnim;life_action_in_use=false;if!(_success) exitWith{[format["Re-filling failed, you only have %1 gallons out of max 100 gallons",life_firehoseGallons]]spawn life_fnc_handleMessage};["You now have 100 gallons of water ready for firefighting usage!"]spawn life_fnc_handleMessage;life_firehoseGallons=100;};case("toggleFirefighter"):{_fireData params[["_houseOnFireObjArray",[],[]]];private _houseOnFireObj=_houseOnFireObjArray select 0;_houseOnFireObj setVariable["ga_firePriority",true,true];player setVariable["ga_hoseComplete",false,2];if((call life_medicLevel)<2) exitWith{};private _action=["Do you understand the AFD guidebook rules of being a firefighter and wish to continute?","AFD Firefighter Division","Yes","No"]call BIS_fnc_GUIMessage;if!(_action) exitWith{};["medicFireRequest",[_houseOnFireObj,typeOf _houseOnFireObj]]spawn life_fnc_medicFireClient;private _nearestSpawnPoint=[["med_spawn_1","Kavala"],["med_spawn_2","Pyrgos"],["med_spawn_3","Athira"],["med_spawn_4","Sofia"],["med_spawn_5","Air HQ"]];private _nearestHQ=[(_nearestSpawnPoint apply{_x select 0}),_houseOnFireObj]call BIS_fnc_nearestPosition;private _locationName=(_nearestSpawnPoint param[(_nearestSpawnPoint findIf{_x param[0,""]isEqualTo _nearestHQ}),[]]) param[1,""];private _asy_pos=getMarkerPos _nearestHQ;private _preLoadout=getUnitLoadout player;private _preSkins=life_uniformBackpack_skins;for"_i"from 1 to 5 step 1 do{titleText[format["Redeploying to %1 in %2 seconds...",_locationName,6-_i],"PLAIN"];uiSleep 1;titleText["","PLAIN"];};["action","reportfirefighter",1]spawn life_fnc_handleQuest;player setPos _asy_pos;private _houseNearestLocation=text(nearestLocations[_houseOnFireObj,["NameCityCapital","NameCity","NameVillage"],5000]select 0);private _loadout=[[],[],[],["U_C_ConstructionCoverall_Red_F",[["ItemMap",1],["SmokeShellRed",2,1],["Chemlight_red",2,1],["Chemlight_yellow",2,1],["SmokeShellYellow",2,1],["SmokeShellGreen",2,1]]],["V_PlateCarrierGL_blk",[]],["B_SCBA_01_F",[]],"H_PilotHelmetHeli_B","G_RegulatorMask_F",["Binocular","","","",[],[],""],["ItemMap","ItemGPS","","ItemCompass","ItemWatch","Integrated_NVG_F"]];player setUnitLoadout _loadout;[]spawn{uiSleep 0.5;[uniform player,"setIdx",48]call life_fnc_clothingTextures;[]call life_fnc_giveMedkits;};private _hoseObject="Land_RefuelingHose_01_F"createVehicle[0,0,0];_hoseObject attachTo[player,[-0.143,-0.125,1.139]];_hoseObject setVectorDirAndUp[[-0.475,-0.028,-0.879],[0.862,-0.214,-0.459]];private _axeObject="Land_Axe_fire_F"createVehicle[0,0,0];_axeObject attachTo[player,[0.053,-0.209,1.203]];_axeObject setVectorDirAndUp[[-0.953,-0.283,0.108],[-0.285,0.959,-0.002]];[[_hoseObject,1200],"TON_fnc_setCleanTime",2]spawn life_fnc_MP;[[_axeObject,1200],"TON_fnc_setCleanTime",2]spawn life_fnc_MP;if!(isNull life_hoseObject) then{deleteVehicle life_hoseObject};if!(isNull life_axeObject) then{deleteVehicle life_axeObject};life_axeObject=objNull;life_hoseObject=objNull;life_isActiveFirefighter=true;life_firehoseGallons=0;life_firehoseProgress=0;life_hoseObject=_hoseObject;life_axeObject=_axeObject;[format["<t align='center' size='1.5' color='#ff1717'>AFD Dispatch</t><br/><br/>You have been given your gear and have been redeployed. You are tasked to take out the fire near %1. Use your fire hose and the AFD tempest fuel to combat the flames!",_houseNearestLocation],"event"]spawn life_fnc_handleMessage;waitUntil{uiSleep 10;!(_houseOnFireObj getVariable["ga_houseOnFire",false])};player setUnitLoadout _preLoadout;life_uniformBackpack_skins=_preSkins;titleText["You have been given back your previous loadout","PLAIN"];[]call life_fnc_hudUpdate;life_isActiveFirefighter=false;[]spawn{uiSleep 0.5;[uniform player,"setUniform",""]call life_fnc_clothingTextures;[backpack player,"setBackpack",""]call life_fnc_clothingTextures;[]call life_fnc_hudUpdate;};{if!(isNull _x) then{deleteVehicle _x};}forEach[_hoseObject,_axeObject];uiSleep 15;if(count SRV_houseOnFire!=0) then{private _houseNearestLocation=text(nearestLocations[SRV_houseOnFire select 0,["NameCityCapital","NameCity","NameVillage"],5000]select 0);[format["<t align='center' size='1.5' color='#ff1717'>AFD Dispatch</t><br/><br/>Another building near %1 has caught fire and needs firefighters! Sign up as a firefighter at your nearest AFD HQ. The building has been marked on your map.",_houseNearestLocation],"event"]remoteExec["life_fnc_handleMessage",independent];};};case("medicFireRequest"):{_fireData params[["_houseOnFireObj",objNull,[objNull]],["_houseType","",[""]]];if(isNull _houseOnFireObj) exitWith{};playSound"air_raid";private _nearestLocation=text(nearestLocations[_houseOnFireObj,["NameCityCapital","NameCity","NameVillage"],5000]select 0);private _marker=createMarkerLocal[format["building_fire%1",random 9999],(getPos _houseOnFireObj)];_marker setMarkerShapeLocal"ICON";_marker setMarkerTypeLocal"mil_pickup";_marker setMarkerTextLocal format["%1 - On Fire",getText(configFile>>"CfgVehicles">>_houseType>>"displayName")];_marker setMarkerColorLocal"ColorOrange";[_marker,_houseOnFireObj]spawn{params["_marker","_houseOnFireObj"];waitUntil{uiSleep 10;!(_houseOnFireObj getVariable["ga_houseOnFire",false])};deleteMarker _marker;};[format["<t align='center' size='1.5' color='#ff1717'>AFD Dispatch</t><br/><br/>You hear the firestation sirens ringing, Whilst gearing up you hear a building near %1 has caught fire! The building has been marked on your map. Quickly rush there to put out the fire!",_nearestLocation]]spawn life_fnc_handleMessage;};case("fireFighterPayment"):{if((remoteExecutedOwner isEqualTo clientOwner)&&!(isServer)) exitWith{};_fireData params[["_paymentFee",-1,[0]],["_homeOwnerUID","",[""]],["_houseType","",[""]],["_houseOnFireObj",objNull,[objNull]]];if(_paymentFee isEqualTo-1) exitWith{};if!(isNull life_hoseObject) then{deleteVehicle life_hoseObject};if!(isNull life_axeObject) then{deleteVehicle life_axeObject};life_isActiveFirefighter=false;life_axeObject=objNull;life_hoseObject=objNull;life_firehoseGallons=0;life_firehoseProgress=0;life_atmCash=life_atmcash+_paymentFee;life_atmcashCache=((life_atmcash/4)+5);life_side_exp=life_side_exp+150;private _homeOwner=allPlayers param[allPlayers findIf{getPlayerUID _x isEqualTo _homeOwnerUID},objNull];private _houseName=getText(configFile>>"CfgVehicles">>_houseType>>"displayName");[["-HOUSEFIRE-",player,(profileName),format["A %1 had its fire extingushed, House Owner UID: %2, House ID: %3, House Pos: %4, Amount Paid to Medic: $%5,",_houseType,_homeOwnerUID,_houseOnFireObj getVariable["ga_houseID",-1],getPos _houseOnFireObj,[_paymentFee]call life_fnc_numberText]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;if(isNull _homeOwner) then{[format["Your were paid $%1 for your courageous firefighting work to this %2",[_paymentFee]call life_fnc_numberText,_houseName],"basic"]spawn life_fnc_handleMessage;}else{[format["Your were paid $%1 for your courageous firefighting work to %2's %3",[_paymentFee]call life_fnc_numberText,name _homeOwner,_houseName],"basic"]spawn life_fnc_handleMessage;};["housefirecompleted",1]call life_fnc_statArrUpdate;};};