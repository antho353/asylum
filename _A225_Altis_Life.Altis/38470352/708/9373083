private _startWpPos=(_waypoints param[0]) param[2];[player,_startWpPos,"Move to the start and await the countdown",0,0]spawn _handleWaypoint;waitUntil{sleep 1;isNull objectParent player||(_startWpPos distance2D player)<_startWaypointRadius||(_startWpPos distance2D player)>200||!(isNull(findDisplay 314))||!(isNull(findDisplay 2900))};if(isNull objectParent player) exitWith{[player,"due to leaving your vehicle"]spawn _handleFailed;};if((_carPos distance2D player)>200) exitWith{[player,"due to moving to far away from the start"]spawn _handleFailed;};if(!(isNull(findDisplay 314))||!(isNull(findDisplay 2900))) exitWith{[player,"LOL, Do you really think we would let you cheat at this"]spawn _handleFailed;};private _secondWpPos=(_waypoints param[1]) param[2];[player,_secondWpPos,"",1,1]spawn _handleWaypoint;private _succes=false;private _countDown=4;for"_i"from 0 to 1 step 0 do{if(isNull objectParent player) exitWith{[player,"due to leaving your vehicle"]spawn _handleFailed;};if!(player getVariable['ga_timeTrialActive',false]) exitWith{[player,"due to stopping your time trial"]spawn _handleFailed;};if(!(isNull(findDisplay 314))||!(isNull(findDisplay 2900))) exitWith{[player,"LOL, Do you really think we would let you cheat at this"]spawn _handleFailed;};if((_startWpPos distance2D player)>200) exitWith{[player,"due to moving to far away from the start"]spawn _handleFailed;};if((_startWpPos distance2D player)<_startWaypointRadius) then{if((speed(objectParent player))<1&&(speed(objectParent player))>-1) then{_countDown=_countDown-1;if(_countDown>0) then{["timeTrialFast",[(format["%1",_countDown])]]call BIS_fnc_showNotification;};}else{_countDown=4;};if(_countDown<=0) then{_succes=true};};if(_succes) exitWith{};uiSleep 1;};life_timeTrialRemovePrimaryWP=true;if!(_succes) exitWith{};["timeTrial",["Go!"]]call BIS_fnc_showNotification;private _checkpoints=_waypoints select{_x param[1]==1};private _finish=_waypoints param[_waypoints findIf{2 isEqualTo(_x select 1)}];private _timer=0;private _checkpointCounter=0;private _isSetWp=false;private _succes=false;for"_i"from 0 to 1 step 0 do{if(isNull objectParent player) exitWith{[player,"due to leaving your vehicle"]spawn _handleFailed;};if!(player getVariable['ga_timeTrialActive',false]) exitWith{[player,"due to stopping your time trial"]spawn _handleFailed;};if(!(isNull(findDisplay 314))||!(isNull(findDisplay 2900))) exitWith{[player,"LOL, Do you really think we would let you cheat at this"]spawn _handleFailed;};if(_timer>9999) exitWith{[player,"due to running out of time"]spawn _handleFailed;};private _primaryCheckpoint=if!(_checkpoints param[_checkpointCounter,[]]isEqualTo[]) then{_checkpoints param[_checkpointCounter]}else{_finish};private _secondaryCheckpoint=if!(_checkpoints param[_checkpointCounter+1,[]]isEqualTo[]) then{_checkpoints param[_checkpointCounter+1]}else{_finish};if(((_primaryCheckpoint param[2]) distance2D player)>2000) exitWith{[player,"due to leaving the tracks"]spawn _handleFailed;};if!(_isSetWp) then{life_timeTrialRemoveSecondaryWP=true;_isSetWp=true;[player,_secondaryCheckpoint param[2],"",1,1]spawn _handleWaypoint;[player,_primaryCheckpoint param[2],"",0,1]spawn _handleWaypoint;};if(((_primaryCheckpoint param[2]) distance2D player)<_waypointRadius) then{life_timeTrialRemovePrimaryWP=true;life_timeTrialRemoveSecondaryWP=true;if(_primaryCheckpoint param[1]==2) exitWith{_succes=true};_checkpointCounter=_checkpointCounter+1;["timeTrial",[format["Checkpoint %1 passed",_checkpointCounter]]]call BIS_fnc_showNotification;_primaryCheckpoint=if!(_checkpoints param[_checkpointCounter,[]]isEqualTo[]) then{_checkpoints param[_checkpointCounter]}else{_finish};_secondaryCheckpoint=if!(_checkpoints param[_checkpointCounter+1,[]]isEqualTo[]) then{_checkpoints param[_checkpointCounter+1]}else{_finish};if(_primaryCheckpoint param[1]!=2) then{if(_secondaryCheckpoint param[1]!=2) then{[player,_secondaryCheckpoint param[2],"",1,1]spawn _handleWaypoint;}else{[player,_secondaryCheckpoint param[2],"",1,2]spawn _handleWaypoint;};[player,_primaryCheckpoint param[2],"",0,1]spawn _handleWaypoint;}else{[player,_primaryCheckpoint param[2],"",0,2]spawn _handleWaypoint;};};if(_succes) exitWith{};_timer=_timer+0.125;uiSleep 0.125;};life_timeTrialRemovePrimaryWP=true;life_timeTrialRemoveSecondaryWP=true;if!(_succes) exitWith{};[player,_id,_carCFG,_timer]remoteExec["TON_fnc_timeTrialSRV",2];uiSleep 2;player setVariable['ga_timeTrialActive',false,true];["action","dotimetrial",1]spawn life_fnc_handleQuest;};case("stop"):{life_timeTrialRemovePrimaryWP=true;life_timeTrialRemoveSecondaryWP=true;if(player getVariable['ga_timeTrialActive',false]) then{player setVariable['ga_timeTrialActive',false,true];};};};