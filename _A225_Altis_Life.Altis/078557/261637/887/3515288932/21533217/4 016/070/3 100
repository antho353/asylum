};params["_target","_caller","_actionID"];while{dialog}do{closeDialog 0};if(life_govCandidates isEqualTo[]||!(life_govCandidatesRequested)) then{life_govCandidatesRequested=false;[["getCandidates",[player,playerSide]],"TON_fnc_govSystemSRV",2]call life_fnc_MP;waitUntil{uiSleep 0.1;life_govCandidatesRequested};};life_govCandidatesRequested=false;disableSerialization;["govVote"]call life_fnc_createDialog;private _asy_display=findDisplay 351000;private _mainListGroup=_asy_display displayCtrl 351002;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _rightListGroup=_asy_display displayCtrl 351003;private _rightItemList=_rightListGroup controlsGroupCtrl 1000;private _voteButton=_rightListGroup controlsGroupCtrl 1001;{_x lnbAddColumn 0.70}forEach[_mainItemList];private _headerInfo=[["Candidate",false],["Votes",true]];{private _mainItemList=_x;private _itemList=_x controlsGroupCtrl 1000;private _itemListWidth=(ctrlPosition _itemList) select 2;private _columnPositions=lnbGetColumnsPosition _itemList;{private _currentColumnPosition=_x*_itemListWidth;(_headerInfo select _forEachIndex) params[["_headerText",""],["_sortByValue",false]];private _nextColumnPosition=if!(_forEachIndex isEqualTo((count _columnPositions)-1)) then{_columnPositions select(_forEachIndex+1)}else{1};_nextColumnPosition=_nextColumnPosition*_itemListWidth;private _control=_asy_display ctrlCreate["Life_RscListNBoxHeaderButton",1002,_mainItemList];_control ctrlSetPosition[_currentColumnPosition,0,(_nextColumnPosition-_currentColumnPosition)+0.0002,0.05];_control ctrlSetStructuredText parseText format["<t size='0.8'>%1</t><t align='right' size='0.6'><img image='%2'/></t>",_headerText,"icons\arrows.paa"];_control ctrlCommit 0;_control ctrlAddEventHandler["ButtonClick",format["[%1, %2, %3, false, _this select 0] call life_fnc_listNBoxSort;",format["((findDisplay 351000) displayCtrl %1) controlsGroupCtrl 1000",ctrlIDC _mainItemList],_forEachIndex,_sortByValue]];if(_forEachIndex isEqualTo 0) then{[_itemList,_forEachIndex,_sortByValue,false,_control]call life_fnc_listNBoxSort};}forEach _columnPositions;}forEach[_mainListGroup];_voteButton ctrlEnable false;_mainItemList ctrlAddEventHandler["LBSelChanged",format["[_this] call %1;",_selectCandidate]];_voteButton ctrlAddEventHandler["ButtonClick",format["[_this select 0] spawn %1;",_submitVote]];private _allControls=allControls _asy_display;{waitUntil{ctrlCommitted _x};_x ctrlSetFade 0;_x ctrlCommit 0.05}forEach _allControls;ctrlSetFocus _mainItemList;lbClear _mainItemList;{_x params["_playerUID","_playerName","_policy","_investment","_votes"];private _color=[0,0.2,0,1];private _formatText=format["%1",[_votes]call life_fnc_numberText];private _rowIndex=_mainItemList lnbAddRow[format["%1",_playerName],_formatText];_mainItemList lnbSetData[[_rowIndex,0],(str _x)];_mainItemList lnbSetValue[[_rowIndex,0],_playerName];_mainItemList lnbSetValue[[_rowIndex,1],round _votes];}forEach life_govCandidates;waitUntil{(isNull _asy_display)};life_govCandidates=[];