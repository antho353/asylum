case(_shopType in _govTaxedShops):{"Tax"};};private _index=life_purchasedVItems findIf{_x select 0==_itemName};if(_index isEqualTo-1) then{life_purchasedVItems pushBack[_itemName,_amount,_cut,_price,_taxName];}else{private _oldValues=life_purchasedVItems select _index;_oldValues params["_itemName","_xAmount","_tax","_prePrice"];life_purchasedVItems set[_index,[_itemName,_xAmount+_amount,_tax+_cut,_prePrice+_price,_taxName]];};[_shopType,_mainItemListSelect]call life_fnc_virtualShopUpdate;[["-ITEMBOUGHT-",player,(profileName),format["purchased %1 %2 for $%3 at POS: %4",[_amount]call life_fnc_numberText,["getName",_item]call life_fnc_virtItemCfg,[_price]call life_fnc_numberText,(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;}else{[format["You do not have room in your inventory for %1 %2",_amount,_itemName],"basic"]spawn life_fnc_handleMessage;};};case("sellItem"):{if!(_item in _sellItems) exitWith{["You can't sell this item!","basic"]spawn life_fnc_handleMessage;};private _amount=parseNumber(ctrlText _mainItemListEdit);private _price=if((_item in _buyItems)&&(_item in _sellItems)) then{private _buyPrice=["getBasePrice",_item]call life_fnc_virtItemCfg;_buyPrice=_buyPrice*([_shopType,true]call life_fnc_getDiscount);private _sellPrice=["getLowestPrice",_item]call life_fnc_virtItemCfg;_sellPrice=_sellPrice*([_shopType,false]call life_fnc_getDiscount);selectMin[_sellPrice,_buyPrice];}else{private _sellPrice=["getLowestPrice",_item]call life_fnc_virtItemCfg;if(_item=="goldbar"&&(life_gang_data select 0) isEqualTo(zaros_flag getVariable["ga_turf_data",[]]select 0)) then{_sellPrice=_sellPrice*1.1}else{_sellPrice};_sellPrice*([_shopType,false]call life_fnc_getDiscount);};private _inInventory=missionNameSpace getVariable[format["life_inv_%1",_item],0];private _itemName=["getName",_item]call life_fnc_virtItemCfg;if(_amount<=0) exitWith{["You need to sell at least one","basic"]spawn life_fnc_handleMessage;};if(_amount>_inInventory) exitWith{["You don't have that many items to sell!","basic"]spawn life_fnc_handleMessage;};private _rebelOutposts=["Rebelop_1","Rebelop_2","Rebelop_3","Rebelop_4","Rebelop_5","Rebelop_6"];if(_item isEqualTo"goldbar"&&(({player distance(getMarkerPos _x)<=200}count _rebelOutposts) isEqualTo 0)) exitWith{["You cannot sell this here!","basic"]spawn life_fnc_handleMessage};private _buffPercent=["questBuffs",false,_item]call life_fnc_getDiscount;private _addBuff=if(_buffPercent isEqualTo 0) then{0}else{(_price*_buffPercent)};_price=round((_price+_addBuff)*_amount);if([false,_item,_amount]call life_fnc_handleInv) then{(wongs_flag getVariable["ga_capData",[0,"Neutral",0.5]]) params["_flagGangID","_flagGangName","_progress"];private _extra="";private _inTurf=(player inArea"turf_area_rodo_flag"||player inArea"turf_area_panagia_flag"||player inArea"turf_area_zaros_flag");private _cut=switch(true) do{case((_shopType=="wongs")&&!(life_wongsCartel select 0)):{floor(_price*0.10)};case((_shopType=="heroin")&&!(life_turfTax select 0)&&_inTurf):{floor(_price*0.20)};default{0};};if((_shopType=="wongs")&&!(life_wongsCartel select 0)&&((call life_adminLevel)<3)) then{private _updateVal=(life_wongsCartel select 1);_updateVal=_updateVal+_cut;_price=_price-_cut;life_wongsCartel set[1,_updateVal];_extra=format[", after a $%1 cut was taken by the owner of Wong Triad.",[_cut]call life_fnc_numberText];};if((_shopType=="heroin")&&!(life_turfTax select 0)&&_inTurf&&((call life_adminLevel)<3)) then{private _updateVal=(life_turfTax select 1);_updateVal=_updateVal+_cut;_price=_price-_cut;life_turfTax set[1,_updateVal];private _nearestFlag=(nearestObjects[player,["Flag_Red_F","FlagPole_F"],500]select 0);private _flagName=["Rodopoli","Zaros","Panagia"]param[[rodo_flag,zaros_flag,panagia_flag]find _nearestFlag,"Capture Point"];_extra=format[", after a $%1 cut was taken by the owner of the %2",[_cut]call life_fnc_numberText,format["%1 Turf",_flagName]];};if(_shopType in["wongs","heroin"]) then{if((((life_lastPersistVar select 0) isEqualTo"ga_drugtrace")&&((life_lastPersistVar select 1)<time))||!((life_lastPersistVar select 0) isEqualTo"ga_drugtrace")) then{[[getPlayerUID player,"ga_drugtrace",time],"TON_fnc_varPersist",2]spawn life_fnc_MP;life_lastPersistVar=["ga_drugtrace",(time+30)];[]spawn{private _time=time;waitUntil{uiSleep 1;(life_cash isEqualTo 0)||((time-_time)>400)};if(life_cash isEqualTo 0) then{[[getPlayerUID player,"ga_drugtrace",-1000],"TON_fnc_varPersist",2]spawn life_fnc_MP;};};};};_control ctrlEnable false;life_cash=(round(life_cash+_price)) max 0;life_cashCache=((life_cash/4)+7);[0]call life_fnc_ClupdatePartial;systemChat format["You sold %1 %2 for $%3%4",_amount,_itemName,[_price]call life_fnc_numberText,_extra];private _index=life_soldVItems findIf{_x select 0==_itemName};if(_index isEqualTo-1) then{life_soldVItems pushBack[_itemName,_amount,_cut,_price];}else{private _oldValues=life_soldVItems select _index;_oldValues params["_itemName","_xAmount","_tax","_prePrice"];life_soldVItems set[_index,[_itemName,_xAmount+_amount,_tax+_cut,_prePrice+_price]];};if(_item in["uraniump","cokebrick","bluemeth","moonshine","moonshinep","oyster","oysterfry"]) then{[format["%1%2",_item,"_sold"],_amount]call life_fnc_statArrUpdate;}else{[_item,_amount]call life_fnc_statArrUpdate;};if(_item isEqualTo"goldbar") then{["goldsold",1]call life_fnc_statArrUpdate;};["sell",_item,_amount]call life_fnc_handleQuest;if(_item in["salema","ornate","mackerel","tuna","mullet","catshark"]) then{["sell","fish",_amount]spawn life_fnc_handleQuest;};if(_price>2500) then{[0]call life_fnc_ClupdatePartial;[true]call life_fnc_saveGear;};[_shopType,_mainItemListSelect]call life_fnc_virtualShopUpdate;[["-ITEMSOLD-",player,(profileName),format["sold %1 %2 for $%3 at POS: %4",[_amount]call life_fnc_numberText,["getName",_item]call life_fnc_virtItemCfg,[_price]call life_fnc_numberText,(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;};};};