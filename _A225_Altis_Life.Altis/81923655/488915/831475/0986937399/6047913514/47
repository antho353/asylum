};uiSleep 1;while{speed player>=2}do{uiSleep _delay;private _amountEarned=_yield;private _randomItem=switch(true) do{case(random 2000<1):{"treasuremap"};case(random 2000<1):{"goldbar"};case(random 2000<1):{"goldnugget"};case(random 2000<1):{"diamondf"};default{(selectRandomWeighted _itemTable) select 0};};private _amountEarned=if(_randomItem in["treasuremap","diamondf","goldnugget","plateMetal"]) then{1}else{_amountEarned};if([true,_randomItem,_amountEarned]call life_fnc_handleInv) then{titleText[format["Unearthed %1 %2. %3/%4",_amountEarned,["getName",_randomItem]call life_fnc_virtItemCfg,life_carryWeight,life_maxWeight],"PLAIN"];if(life_currentTalents<10) then{life_side_exp=life_side_exp+2;};playSound"metalDetectScan";private _index=_gathered findIf{(_x select 0) isEqualTo _randomItem};if(_index isEqualTo-1) then{_gathered pushBack[_randomItem,_amountEarned];}else{private _currentAmount=(_gathered select _index) select 1;(_gathered select _index) set[1,_currentAmount+_amountEarned];};}else{_exit=true;};if(_exit||(player distance(getMarkerPos _zone)>_distance)||!(isNull objectParent player)||!(life_action_in_use)||!((profileNamespace getVariable["ga_metalDetectorID",-1]) isEqualTo _randomID)) exitWith{};};if(_exit) then{titleText["Metal Detecting done. You can't hold more metals.","PLAIN"];}else{titleText["Metal Detecting cancelled.","PLAIN"];["You must be constantly moving to detect metals!","basic"]spawn life_fnc_handleMessage;};life_action_gathering=false;life_action_in_use=false;deleteVehicle _asy_obj;[["-GATHER-",player,profileName,format["Metal Detected %1 at position %2.",_gathered apply{[["getName",_x select 0]call life_fnc_virtItemCfg,_x select 1]},getPosATL player]],"TON_fnc_logIt",2]spawn life_fnc_MP;