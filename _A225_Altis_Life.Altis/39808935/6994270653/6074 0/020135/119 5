if(_spawnPoint isEqualTo"") exitWith{["There is a vehicle currently blocking the spawn point(s).","basic"]spawn life_fnc_handleMessage;closeDialog 0;_blockedSpawn=true;};};if(_blockedSpawn) exitWith{};life_cash=life_cash-_cashRequired;life_cashCache=((life_cash/4)+7);[0]call life_fnc_ClupdatePartial;{_x params["_item","_amount"];if!(_item isEqualTo"life_cash") then{[false,["getShortName",_item]call life_fnc_virtItemCfg,_amount]call life_fnc_handleInv;};}forEach _recipe;switch(true) do{case(_classname isKindOf"Car"||_classname isKindOf"Ship"||_classname isKindOf"Air"):{["vehiclescrafted",1]call life_fnc_statArrUpdate;};case(_className isKindOf["Rifle",configFile>>"CfgWeapons"]):{["weaponscrafted",1]call life_fnc_statArrUpdate;};case(_className isKindOf["Launcher",configFile>>"CfgWeapons"]):{["weaponscrafted",1]call life_fnc_statArrUpdate;};case(_className isKindOf["Pistol",configFile>>"CfgWeapons"]):{["weaponscrafted",1]call life_fnc_statArrUpdate;};};switch(true) do{case(_className isKindOf"Air"):{["craft","air",1]call life_fnc_handleQuest;};case(_className in["B_MRAP_01_F","O_MRAP_02_F"]):{["craft","armor",1]call life_fnc_handleQuest;};case(_className in _762):{["craft","762guns",1]call life_fnc_handleQuest;};};if(_sell) exitWith{private _weaponPrices=life_factory_prices;private _blackMarket=["B_G_Offroad_01_F","B_G_Offroad_01_armed_F","O_MRAP_02_F","I_MRAP_03_F","I_Heli_light_03_unarmed_F","O_Heli_Light_02_unarmed_F","30Rnd_65x39_caseless_green","20Rnd_762x51_Mag","arifle_Katiba_F","arifle_Katiba_C_F","LMG_Mk200_F","srifle_DMR_01_F","srifle_EBR_F","srifle_DMR_03_khaki_F","srifle_DMR_03_multicam_F","srifle_DMR_03_tan_F","srifle_DMR_03_woodland_F","srifle_DMR_06_olive_F","srifle_DMR_06_camo_F","arifle_AKM_F","arifle_AK12_F","arifle_SPAR_03_khk_F","arifle_SPAR_03_snd_F","LMG_03_F","30Rnd_762x39_Mag_F"];private _price=if(isClass(configFile>>"CfgVehicles">>_className)) then{["getVehicleRowParsed","",_className]call life_fnc_vehicleConfig select 7;}else{(_weaponPrices param[_weaponPrices findIf{_className in _x},0]) param[1,0];};if(_price isEqualTo 0) exitWith{closeDialog 0};_price=_price*0.65;if(_className in _blackMarket) then{private _gangID=life_gang_data param[0,-25];private _flagID=(arms_flag getVariable["ga_capData",[]]) param[0,-1];private _cartelText="";if!(_flagID isEqualTo _gangID) then{private _cut=floor(_price*0.15);[[2,_flagID,player,_cut],"TON_fnc_gangBank",2]spawn life_fnc_MP;_price=_price-_cut;_cartelText=format["A $%1 cut has been taken by the Arms Cartel.",[_cut]call life_fnc_numberText];};life_cash=life_cash+_price;life_cashCache=((life_cash/4)+7);[0]call life_fnc_ClUpdatePartial;[format["You have sold the produced item for the current market value of $%1. The funds have been given to you on hand. %2",[_price]call life_fnc_numberText,_cartelText],"basic"]spawn life_fnc_handleMessage;closeDialog 0;}else{life_atmcash=life_atmcash+_price;life_atmcashCache=((life_atmcash/4)+5);[1]call life_fnc_ClUpdatePartial;[format["You have produced the selected item for the current market value of $%1. The funds have been deposited into your bank account.",[_price]call life_fnc_numberText],"basic"]spawn life_fnc_handleMessage;closeDialog 0;};[["-CRAFTING-",player,(profileName),format["crafted a %1 and sold it for $%2 at POS: %3",_className,[_price]call life_fnc_numberText,(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;};if(isClass(configFile>>"CfgMagazines">>_className)) exitWith{player addMagazine _className;[format["The factory has produced a %1 with your materials. You have received the item.",getText(configFile>>"CfgMagazines">>_className>>"displayName")],"basic"]spawn life_fnc_handleMessage;};if(isClass(configFile>>"CfgVehicles">>_className)) then{private _markers=["veh_sp_84","veh_sp_85","veh_sp_86","veh_sp_91","veh_sp_92","veh_sp_93","veh_sp_94","veh_sp_96"];private _spawnPoint=_markers param[_markers findIf{nearestObjects[getMarkerPos _x,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getMarkerPos _x,["Air"],14]isEqualTo[]&&((player distance2D(getMarkerPos _x)<=100))},""];if(_spawnPoint isEqualTo"") exitWith{["There is a vehicle currently blocking the spawn point(s).","basic"]spawn life_fnc_handleMessage;closeDialog 0};private _asy_pos=getMarkerPos _spawnPoint;_asy_pos set[2,(_asy_pos select 2)+1.5];private _vehicle=createVehicle[_classname,[random 999,random 999,999],[],0,"CAN_COLLIDE"];waitUntil{!isNil"_vehicle"&&{!isNull _vehicle}};_vehicle lock true;_vehicle allowDamage false;_vehicle setDir(markerDir _spawnPoint);_vehicle setPos _asy_pos;_vehicle setVectorUp(surfaceNormal(_asy_pos));private _skinID=lbValue[1804,lbCurSel 1804];if(isNil"_skinID") then{_skinID=-1};[_vehicle,[0,0,0,0],_skinID,"",[0,0.5],false]spawn life_fnc_prepareVehicle;[format["The factory has produced a %1 with your materials. You have received the keys and it is now parked outside.",getText(configFile>>"CfgVehicles">>_className>>"displayName")],"basic"]spawn life_fnc_handleMessage;[[player,_vehicle,getPlayerUID player,"civ",_skinID,0],"TON_fnc_vehicleCreate",2]spawn life_fnc_MP;[6]call life_fnc_ClupdatePartial;[["-CRAFTING-",player,(profileName),format["crafted a %1 to keep at POS: %2",getText(configFile>>"CfgVehicles">>_className>>"displayName"),(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;}else{if("optic"in _classname) then{player addItem _classname;}else{[_className,true,false,true,false]call life_fnc_handleItem;};[format["The factory has produced a %1 with your materials. You have received the item.",getText(configFile>>"CfgWeapons">>_className>>"displayName")],"basic"]spawn life_fnc_handleMessage;[["-CRAFTING-",player,(profileName),format["crafted a %1 to keep at POS: %2",getText(configFile>>"CfgWeapons">>_className>>"displayName"),(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;};closeDialog 0;