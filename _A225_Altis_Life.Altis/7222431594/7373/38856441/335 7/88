while{!_success}do{if(speed player>1) exitWith{};if((player distance _wreck)>20) exitWith{titleText["You need to be closer to a ship wreck to use the excavator.","PLAIN"]};if(_depth>-15) exitWith{titleText["The excavator requires more water pressure (you're not deep enough).","PLAIN"]};if(life_carryWeight>=life_maxWeight) exitWith{_success=true;};private _randomItem=switch(true) do{case(random 2500<1):{"treasuremap"};case(random 5000<1):{"goldbar"};case(random 3000<1):{"goldnugget"};default{(selectRandomWeighted _itemTable) select 0};};private _sum=[_randomItem,1,life_carryWeight,life_maxWeight]call life_fnc_calWeightDiff;private _itemWeight=["getItemWeight",_randomItem]call life_fnc_virtItemCfg;if(_sum>0) then{if([true,_randomItem,1]call life_fnc_handleInv) then{uiSleep _delay;titleText[format["You have collected 1 %1 from the wreck.",["getName",_randomItem]call life_fnc_virtItemCfg],"PLAIN"];titleFadeOut 1.5;life_side_exp=life_side_exp+2;_weightGained=_weightGained+_itemWeight;};};};life_action_gathering=false;life_action_in_use=false;if(_success) then{titleText["The excavator is full, check your haul!","PLAIN"];["action","excavatorfull",1]call life_fnc_handleQuest;}else{titleText["Excavation has failed!","PLAIN"];};