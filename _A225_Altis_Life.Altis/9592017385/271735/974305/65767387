if!(params[["_button",controlNull],["_mode",-1]]) exitWith{};disableSerialization;private _message=ctrlText 3001;if((!alive player)||(isNull player)) exitWith{};if(_mode isEqualTo 4) exitWith{["This message type is currently disabled.","basic"]spawn life_fnc_handleMessage;};if((_message isEqualTo"")&&!(_mode in[4])) exitWith{["You must enter a message to send!","basic"]spawn life_fnc_handleMessage;};private _disallowedContent=["<br/>","<t","<img","<a"]apply{toLower _x};if!(_disallowedContent findIf{_x in toLower _message}isEqualTo-1) exitWith{systemChat format["Your message contains disallowed content: %1",_disallowedContent select{_x in toLower _message}joinString", "]};switch(_mode) do{case 0:{if!((lbCurSel 3002)>=0) exitWith{["You must select a player you are sending the text to!","basic"]spawn life_fnc_handleMessage;};if((count _message)>200) exitWith{["The message you entered is too long to send!","basic"]spawn life_fnc_handleMessage;};private _target=allPlayers param[allPlayers findIf{(lbData[3002,lbCurSel 3002]) isEqualTo(getPlayerUID _x)},objNull];if(isNull _target) exitWith{["The player you are trying to message can't be found","basic"]spawn life_fnc_handleMessage;};if(((side _target) isEqualTo west)&&((life_is_arrested select 0) isEqualTo 1)) exitWith{["Prison inmates are not allowed to message officers of the law!","basic"]spawn life_fnc_handleMessage;};[]spawn life_fnc_cellphone;[[_mode,player,_target,_message],"TON_fnc_handlePhoneMsg",false]call life_fnc_MP;[format["You sent %1 a message: %2",[name _target]call life_fnc_cleanName,_message],"basic"]spawn life_fnc_handleMessage;};case 1:{if((count _message)>200) exitWith{["The message you entered is too long to send!","basic"]spawn life_fnc_handleMessage;};private _target="The Police";if((life_is_arrested select 0) isEqualTo 1) exitWith{["Prison inmates are not allowed to message officers of the law!","basic"]spawn life_fnc_handleMessage;};[]spawn life_fnc_cellphone;[[_mode,player,objNull,_message],"TON_fnc_handlePhoneMsg",false]call life_fnc_MP;[format["You sent %1 a message: %2",_target,_message],"basic"]spawn life_fnc_handleMessage;};case 2:{if((count _message)>200) exitWith{["The message you entered is too long to send!","basic"]spawn life_fnc_handleMessage;};private _target="Emergency Medical";[]spawn life_fnc_cellphone;[[_mode,player,objNull,_message],"TON_fnc_handlePhoneMsg",false]call life_fnc_MP;[format["You sent %1 a message: %2",_target,_message],"basic"]spawn life_fnc_handleMessage;};case 3:{if((count _message)>200) exitWith{["The message you entered is too long to send!","basic"]spawn life_fnc_handleMessage;