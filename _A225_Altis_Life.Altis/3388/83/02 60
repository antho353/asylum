#include"..\..\macro.h"
if(scriptAvailable(5)) exitWith{["Wait a few seconds before pulling another vehicle.","basic"]spawn life_fnc_handleMessage;};disableSerialization;if((lbCurSel 100151) isEqualTo-1) exitWith{["You did not select a vehicle to retrieve from your garage!","basic"]spawn life_fnc_handleMessage;closeDialog 0;};private _vehicle=parseSimpleArray(lbData[100151,lbCurSel 100151]);if(isNil"_vehicle") exitWith{["There was an error selecting your vehicle from the garage. Please try again.","basic"]spawn life_fnc_handleMessage;closeDialog 0;};_vehicle params["_classname","_plate","_color","","_mods","_vehWear","_customPlate"];if!(life_vehicles findIf{(_x getVariable["ga_dbInfo",[]]param[1,-1]) isEqualTo _plate}isEqualTo-1) exitWith{["This vehicle is already in use.","basic"]spawn life_fnc_handleMessage};if((_classname isEqualTo"O_APC_Wheeled_02_rcws_v2_F")&&(count(vehicles select{typeOf _x isEqualTo"O_APC_Wheeled_02_rcws_v2_F"}) isNotEqualTo 0)) exitWith{closeDialog 0;["The maximum amount of Madrids have been pulled.","basic"]spawn life_fnc_handleMessage;};if((_classname isEqualTo"B_G_Offroad_01_armed_F")&&(call life_fnc_isDominationActive)) exitWith{closeDialog 0;["This vehicle is currently disabled!","basic"]spawn life_fnc_handleMessage;};private _vehCfgRow=["getVehicleRowParsed","",_classname]call life_fnc_vehicleConfig;if(_vehCfgRow isEqualTo[]) exitWith{};private _textureShopFlags=(["specific",_classname,_color]call life_fnc_vehicleTextures) param[2,[""]];if(playerSide isEqualTo west&&!(call life_fnc_isDominationActive)&&{life_copRole!="detective"&&life_copRole!="all"&&(!("cop"in _textureShopFlags)&&!("fed"in _textureShopFlags))}) exitWith{["This vehicle can only be used when you are in the undercover role.","basic"]spawn life_fnc_handleMessage};private _spawnPoint="";if(life_garage_sp isEqualType[]) then{if(!(call life_fnc_isDominationActive)) then{if(_classname isKindOf"Land") then{life_garage_sp=life_garage_sp select{"_g_"in(str _x)}};if(_classname isKindOf"Air") then{life_garage_sp=life_garage_sp select{"_air_"in(str _x)}};if(_classname isKindOf"Ship") then{life_garage_sp=life_garage_sp select{"_sea_"in(str _x)}};};if((life_garage_sp param[0,objNull]) isEqualType objNull) then{if!(surfaceIsWater position player) then{_spawnPoint=life_garage_sp param[life_garage_sp findIf{nearestObjects[getPosATL _x,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getPosATL _x,["Air"],14]isEqualTo[]&&(player distance2D(getPosATL _x)<=100)},""];}else{_spawnPoint=life_garage_sp param[life_garage_sp findIf{nearestObjects[getPosASL _x,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getPosASL _x,["Air"],14]isEqualTo[]&&(player distance2D(getPosASL _x)<=100)},""];};}else{_spawnPoint=life_garage_sp param[life_garage_sp findIf{nearestObjects[getMarkerPos _x,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getMarkerPos _x,["Air"],14]isEqualTo[]&&(player distance2D(getMarkerPos _x)<=100)},""];};}else{if(life_garage_sp isKindOf"House_F") then{if(nearestObjects[getPosATL life_garage_sp,["Car","Air"],9]isEqualTo[]) then{_spawnPoint=life_garage_sp};}else{if(nearestObjects[getPosATL life_garage_sp,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getPosATL life_garage_sp,["Air"],14]isEqualTo[]&&(player distance2D(getPosATL life_garage_sp)<=100)) then{_spawnPoint=life_garage_sp};};};if(playerSide isEqualTo civilian&&_classname isEqualTo"B_MRAP_01_F"&&!license_civ_bounty) exitWith{["You need a Bounty Hunter license to pull this vehicle from your garage.","basic"]spawn life_fnc_handleMessage;closeDialog 0;};if(_spawnPoint isEqualTo"") exitWith{["There is a vehicle currently blocking the spawn point(s).","basic"]spawn life_fnc_handleMessage;