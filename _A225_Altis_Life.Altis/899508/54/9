{_x ctrlSetPosition[(ctrlPosition _x) select 0,(ctrlPosition _x) select 1,(ctrlPosition _x) select 2,((ctrlPosition _x) select 3)+(_leftFilterListPosition select 3)+0.0055]}forEach[_leftItemList,_leftItemListBackground];{_x ctrlCommit 0}forEach(allControls _asy_display);};{_x params["_itemListGroup","_itemListName"];private _headerInfo=if(_itemListName isEqualTo"Resources") then{[["Resource",false],["Type",false]]}else{[["Listing Information",false],["Price",true]]};private _idx=_forEachIndex;private _itemList=_itemListGroup controlsGroupCtrl 1000;private _itemListWidth=(ctrlPosition _itemList) select 2;private _columnPositions=lnbGetColumnsPosition _itemList;{private _currentColumnPosition=_x*_itemListWidth;(_headerInfo select _forEachIndex) params[["_headerText",""],["_sortByValue",false]];private _nextColumnPosition=if!(_forEachIndex isEqualTo((count _columnPositions)-1)) then{_columnPositions select(_forEachIndex+1)}else{1};_nextColumnPosition=_nextColumnPosition*_itemListWidth;private _control=_asy_display ctrlCreate["Life_RscListNBoxHeaderButton",1002,_itemListGroup];_control ctrlSetPosition[_currentColumnPosition,0,(_nextColumnPosition-_currentColumnPosition)+0.0002,0.05];_control ctrlSetStructuredText parseText format["<t size='0.8'>%1</t><t align='right' size='0.6'><img image='%2'/></t>",_headerText,"icons\arrows.paa"];_control ctrlCommit 0;_control ctrlAddEventHandler["ButtonClick",format["[%1, %2, %3, false, _this select 0] call life_fnc_listNBoxSort;",format["((findDisplay 875000) displayCtrl %1) controlsGroupCtrl 1000",ctrlIDC _itemListGroup],_forEachIndex,_sortByValue]];if(_forEachIndex isEqualTo 0) then{[_itemList,_forEachIndex,_sortByValue,false,_control]call life_fnc_listNBoxSort};}forEach _columnPositions;}forEach[[_mainListGroup,"Listings"],[_leftListGroup,"Resources"]];{_x ctrlEnable false;}forEach[_purchaseListingButton,_checkAvailButton,_retractListingButton];_mainFilterList ctrlAddEventHandler["LBSelChanged",format["['%1', _this] call life_fnc_exchangeMenuFilter;","listingFilter"]];_leftFilterList ctrlAddEventHandler["LBSelChanged",format["['%1', _this] call life_fnc_exchangeMenuFilter;","resourcesFilter"]];_mainItemList ctrlAddEventHandler["LBSelChanged",format["['%1', _this] call life_fnc_exchangeMenuSelection;","selectedListing"]];_leftItemList ctrlAddEventHandler["LBSelChanged",format["['%1', _this] call life_fnc_exchangeMenuSelection;","selectedResource"]];_retractListingButton ctrlAddEventHandler["ButtonClick",format["['%1', _this select 0] spawn life_fnc_exchangeMenuManage;","removeListing"]];_purchaseListingButton ctrlAddEventHandler["ButtonClick",format["['%1', _this select 0] spawn life_fnc_exchangeMenuManage;","purchaseListing"]];_checkAvailButton ctrlAddEventHandler["ButtonClick",format["['%1', _this select 0] spawn life_fnc_exchangeMenuManage;","checkListing"]];_mainFilterList lbSetCurSel 2;_leftFilterList lbSetCurSel 0;private _allControls=allControls _asy_display;if((lbSize _mainFilterList)<=1) then{_allControls=_allControls-[_mainFilterList]};if((lbSize _leftFilterList)<=1) then{_allControls=_allControls-[_leftFilterList]};{waitUntil{ctrlCommitted _x};_x ctrlSetFade 0;_x ctrlCommit 0.05}forEach _allControls;private _refreshTime=time+180;if(life_exchangeAllListings isEqualTo[]) then{["It appears there are no listings on the Asylum Exchange","basic"]spawn life_fnc_handleMessage;}else{[format["The top %1 cheapest listing(s) of each item type on the entire Asylum Exchange have been fetched. Check availability of other items to search for listings for that specific item.",count life_exchangeAllListings],"basic"]spawn life_fnc_handleMessage;};waitUntil{uiSleep 0.1;isNull _asy_display||time>_refreshTime};life_exchangeRequested=false;life_exchangePlayerOwnedListings=[];life_exchangeAllListings=[];life_exchangeStorageMaxListings=[0,0];if(time>_refreshTime) exitWith{["Refreshing the Asylum Exchange...","basic"]spawn life_fnc_handleMessage;[_this]spawn life_fnc_exchangeMenu;};