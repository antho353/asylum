};if!(life_bloodMoneyShop) then{if!([round(_price+_tax)]call life_fnc_debitCard) exitWith{[format["You cannot afford this item. You need $%1.",[_price]call life_fnc_numberText],"basic"]spawn life_fnc_handleMessage;_exit=true;};}else{if(life_bloodMoney<_price) exitWith{[format["You cannot afford this item. You need %1 BM",[_price]call life_fnc_numberText],"basic"];_exit=true};life_bloodMoney=life_bloodMoney-_price;};if(_exit) exitWith{};if(_shopType in["skiptracer"]) then{["action","skiptracerspend",_price]spawn life_fnc_handleQuest;};[_class,true,false,true,false,false,false,false]call life_fnc_handleItem;private _cfgClass=if("Grenade"in _class) then{"CfgMagazines"}else{"CfgWeapons"};if(((_itemType select 1) in["primary weapon","secondary weapon","handgun"])||(toLower _class in["handgrenade","minigrenade"])) then{[["-WEAPONBOUGHT-",player,(profileName),format["purchased a %1 for %2 at POS: %3",getText(configFile>>_cfgClass>>_class>>"displayName"),_priceText,(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;if(_shopType=="gun") then{["buy","gunstoregun",1]spawn life_fnc_handleQuest;}};private _extra="";private _cut=0;if(!(life_bloodMoneyShop)&&(_shopType=="rebelwep")&&!(life_armsCartel select 0)&&((call life_adminLevel)<3)) then{_cut=floor((_price)*0.08);private _updateVal=(life_armsCartel select 1);_updateVal=_updateVal+_cut;life_armsCartel set[1,_updateVal];_extra="Arms";};if(!(life_bloodMoneyShop)&&(_shopType isNotEqualTo"rebelwep")&&((call life_adminLevel)<3)) then{_cut=floor((_price)*(call life_fnc_getGovTax));private _updateVal=(life_govTax select 1);_updateVal=_updateVal+_cut;life_govTax set[1,_updateVal];_extra="Tax";};playSound"purchase";private _index=life_purchasedGear findIf{_x select 0==_class};if(_index isEqualTo-1) then{life_purchasedGear pushBack[_class,1,_cut,_itemDetails select 1,_price,_extra];}else{private _oldValues=life_purchasedGear select _index;_oldValues params["_item","_amount","_tax","_itemName","_prePrice"];life_purchasedGear set[_index,[_item,_amount+1,_tax+_cut,_itemName,_prePrice+_price,_extra]];};{_x params["_itemList","_itemListButton"];private _selectedIndex=lbCurSel _itemList;for"_rowIndex"from 0 to((lbSize _itemList)-1) do{private _class=_itemList lnbData[_rowIndex,0];private _price=_itemList lnbValue[_rowIndex,1];private _color=[1,1,1,0.5];if(call life_fnc_isDominationActive) then{_color set[3,1];}else{if(_shopType in["rebelwep","turf"]) then{if!(life_bloodMoneyShop) then{if(life_cash>=_price) then{_color set[3,1]};}else{if(life_bloodMoney>=_price) then{_color set[3,1]};};};if(((life_cash>=_price)||((life_atmcash>=_price)&&(life_inv_debitcard>=1)))&&!(_shopType in["rebelwep","turf"])) then{_color set[3,1]};};for"_columnIndex"from 0 to 1 do{_itemList lnbSetColor[[_rowIndex,_columnIndex],_color]};if(_rowIndex isEqualTo _selectedIndex) then{_itemListButton ctrlEnable(((_itemList lnbColor[_selectedIndex,0]) select 3) isEqualTo 1)};};}forEach[[_mainItemList,_mainItemListButton],[_sideItemList,_sideItemListButton]];private _titleText=([_shopType]call life_fnc_weaponShopCfg) select 0;if(life_bloodMoneyShop) then{_titleText=_titleText+(format[" - %1 BM",life_bloodMoney])};_title ctrlSetText _titleText;