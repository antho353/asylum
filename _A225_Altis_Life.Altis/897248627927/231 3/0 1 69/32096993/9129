params["_target","_caller","_actionID","_type"];if!(alive player) exitWith{};if(life_action_in_use) exitWith{};if(life_loadoutHolder isEqualTo[]||!(life_loadoutRequested)) then{life_loadoutRequested=false;[[player,playerSide,1],"TON_fnc_fetchLoadouts",2]call life_fnc_MP;waitUntil{uiSleep 0.1;life_loadoutRequested};};["life_loadout_system"]call life_fnc_createDialog;private _asy_display=findDisplay 39400;if(isNull _asy_display) exitWith{};private _filterList=_asy_display displayCtrl 39402;private _mainListGroup=_asy_display displayCtrl 39404;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _sideListGroup=_asy_display displayCtrl 39405;private _sideItemList=_sideListGroup controlsGroupCtrl 1000;private _sideItemListButton=_sideListGroup controlsGroupCtrl 1001;private _deleteButton=_sideListGroup controlsGroupCtrl 1005;private _saveButton=_sideListGroup controlsGroupCtrl 1004;private _dollarsButton=_sideListGroup controlsGroupCtrl 1006;private _bloodMoneyButton=_sideListGroup controlsGroupCtrl 1007;{_x lnbAddColumn 0.70}forEach[_mainItemList,_sideItemList];{private _headerInfo=if(_forEachIndex isEqualTo 0) then{[["Name",false],["Quantity",false]]}else{[["Name",false],["Price",true]]};private _idx=_forEachIndex;private _itemListGroup=_x;private _itemList=_x controlsGroupCtrl 1000;private _itemListWidth=(ctrlPosition _itemList) select 2;private _columnPositions=lnbGetColumnsPosition _itemList;{private _currentColumnPosition=_x*_itemListWidth;(_headerInfo select _forEachIndex) params[["_headerText",""],["_sortByValue",false]];private _nextColumnPosition=if!(_forEachIndex isEqualTo((count _columnPositions)-1)) then{_columnPositions select(_forEachIndex+1)}else{1};_nextColumnPosition=_nextColumnPosition*_itemListWidth;private _control=_asy_display ctrlCreate["Life_RscListNBoxHeaderButton",1002,_itemListGroup];_control ctrlSetPosition[_currentColumnPosition,0,(_nextColumnPosition-_currentColumnPosition)+0.0002,0.05];private _arrows=if(_idx isEqualTo 0) then{"<img image='icons\arrows.paa'/></t>"}else{""};_control ctrlSetStructuredText parseText format["<t size='0.8'>%1</t><t align='right' size='0.6'>%2",_headerText,_arrows];_control ctrlCommit 0;if(_idx isEqualTo 0) then{_control ctrlAddEventHandler["ButtonClick",format["[%1, %2, %3, false, _this select 0] call life_fnc_listNBoxSort;",format["((findDisplay 39400) displayCtrl %1) controlsGroupCtrl 1000",ctrlIDC _itemListGroup],_forEachIndex,_sortByValue]];if(_forEachIndex isEqualTo 0) then{[_itemList,_forEachIndex,_sortByValue,false,_control]call life_fnc_listNBoxSort};};}forEach _columnPositions;}forEach[_mainListGroup,_sideListGroup];{_x ctrlEnable false;}forEach[_sideItemListButton,_deleteButton,_saveButton];_sideItemList ctrlAddEventHandler["LBSelChanged","[_this] call life_fnc_loadoutSelection;"];_mainItemList ctrlAddEventHandler["LBSelChanged","[_this] call life_fnc_loadoutPreview;"];_saveButton ctrlAddEventHandler["ButtonClick",format["['%1', _this] spawn life_fnc_saveLoadout;",_type]];_deleteButton ctrlAddEventHandler["ButtonClick",format["['%1', _this] spawn life_fnc_deleteLoadout;",_type]];_dollarsButton ctrlAddEventHandler["ButtonClick",format["['%1', _this, '$'] spawn life_fnc_equipLoadout",_type]];_bloodMoneyButton ctrlAddEventHandler["ButtonClick",format["['%1', _this, 'BM'] spawn life_fnc_equipLoadout",_type]];if(_type isEqualTo"rebel") then{_sideItemListButton ctrlAddEventHandler["ButtonClick",format["['%1', _this] spawn life_fnc_chooseLoadoutCurrency",_type]];