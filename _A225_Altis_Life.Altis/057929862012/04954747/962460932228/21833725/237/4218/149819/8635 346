_nextColumnPosition=_nextColumnPosition*_itemListWidth;private _control=_asy_display ctrlCreate["Life_RscListNBoxHeaderButton",1002,_itemListGroup];_control ctrlSetPosition[_currentColumnPosition,0,(_nextColumnPosition-_currentColumnPosition)+0.0002,0.05];_control ctrlSetStructuredText parseText format["<t size='0.8'>%1</t><t align='right' size='0.6'><img image='%2'/></t>",_headerText,"icons\arrows.paa"];_control ctrlCommit 0;_control ctrlAddEventHandler["ButtonClick",format["[%1, %2, %3, false, _this select 0] call life_fnc_listNBoxSort;",format["((findDisplay 39400) displayCtrl %1) controlsGroupCtrl 1000",ctrlIDC _itemListGroup],_forEachIndex,_sortByValue]];if(_forEachIndex isEqualTo 0) then{[_itemList,_forEachIndex,_sortByValue,false,_control]call life_fnc_listNBoxSort};}forEach _columnPositions;}forEach[_mainListGroup,_sideListGroup];{_x ctrlEnable false}forEach[_mainItemListButton,_sideItemListButton];_mainItemList ctrlAddEventHandler["LBSelChanged",format["['%1', _this] call life_fnc_weaponShopSelection;",_shopType]];_sideItemList ctrlAddEventHandler["LBSelChanged",format["['%1', _this] call life_fnc_weaponShopSelection;",_shopType]];_filterList ctrlAddEventHandler["LBSelChanged",format["['%1', _this] call life_fnc_weaponShopFilter;",_shopType]];{_x ctrlAddEventHandler["ButtonClick",format["['%1', _this select 0] spawn life_fnc_weaponShopBuy;",_shopType]]}forEach[_mainItemListButton,_sideItemListButton];_filterList lbSetCurSel 0;private _allControls=allControls _asy_display;if((lbSize _filterList)<=1) then{_allControls=_allControls-[_filterList]};{waitUntil{ctrlCommitted _x};_x ctrlSetFade 0;_x ctrlCommit 0.05}forEach _allControls;ctrlSetFocus _mainItemList;waitUntil{isNull(findDisplay 39400)};if(life_bloodMoneyShop) then{life_bloodMoneyShop=false;if!(life_bloodMoney isEqualTo _preBloodMoney) then{[18]call life_fnc_ClupdatePartial;};};[false]call life_fnc_saveGear;if(life_lastSynced_gear!=str(life_gear)) then{[3]call life_fnc_ClupdatePartial;[6]call life_fnc_ClupdatePartial;};if!(_bloodMoneyShop) then{if(!((life_armsCartel select 2) isEqualTo-1)&&!((life_armsCartel select 1) isEqualTo 0)) then{[[2,life_armsCartel select 2,player,life_armsCartel select 1],"TON_fnc_gangBank",false,false]spawn life_fnc_MP;life_armsCartel=[false,0,-1];};};if(life_purchasedGear isEqualTo[]) exitWith{};private _gear="";private _totalPrice=0;private _armsTax=0;{_x params["_item","_amount","_tax","_itemName","_price"];_gear=_gear+format["%1 - %2<br/>",_amount,_itemName];_totalPrice=_totalPrice+_price;_armsTax=_armsTax+_tax;}forEach life_purchasedGear;private _extra=switch((life_purchasedGear param[0,[]]) param[5,"Woops"]) do{case("Arms"):{format[", with <t color='#7FFF00'>$%1</t> going to the %2",[_armsTax]call life_fnc_numberText,"Arms Dealer"]};case("Tax"):{format[", including a tax of <t color='#7FFF00'>$%1</t>",[_armsTax]call life_fnc_numberText]};default{""};};if(_bloodMoneyShop) then{_armsTax=0;};private _extra=if!(_armsTax isEqualTo 0) then{_extra}else{""};private _formatText=if!(_bloodMoneyShop) then{format["<t align='center'>You bought:<br/>%1for <t color='#7FFF00'>$%2</t>%3",_gear,[_totalPrice]call life_fnc_numberText,_extra];}else{format["<t align='center'>You bought:<br/>%1for <t color='#7FFF00'>%2 BM</t>%3",_gear,[_totalPrice]call life_fnc_numberText,_extra]};if((call life_fnc_isDominationActive)&&([player]) call life_fnc_inDomSafezone&&((call life_adminLevel)<3)) then{life_dominationPotCache=life_dominationPotCache+_totalPrice;[format["This purchase has added $%1 to the domination event prize pool!",[_totalPrice]call life_fnc_numberText]]spawn life_fnc_handleMessage;};private _rebelOutposts=["Rebelop_1","Rebelop_2","Rebelop_3","Rebelop_4","Rebelop_5","Rebelop_6"];if!(({player distance(getMarkerPos _x)<=200}count _rebelOutposts) isEqualTo 0) then{["moneyspentrebel",_totalPrice]call life_fnc_statArrUpdate;};[_formatText,"weppurchase"]spawn life_fnc_handleMessage;life_purchasedGear=[];