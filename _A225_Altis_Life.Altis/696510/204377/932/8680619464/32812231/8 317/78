#include"..\..\..\..\..\..\macro.h"
if(scriptAvailable(5)) exitWith{["You can only attempt to open your Asylum Exchange Storage every couple seconds!","basic"]spawn life_fnc_handleMessage;};params["_target","_caller","_actionID"];if(!alive player||life_action_in_use) exitWith{};if!(SRV_exchangeIsReady) exitWith{["The Asylum Exchange is still being initialized, wait a moment!","basic"]};if(life_exchangeFailedListings isEqualTo[]||life_exchangeStorage isEqualTo[]||!(life_exchangeStorageRequested)) then{life_exchangeStorageRequested=false;[[6,[0,getPlayerUID player,player]],"TON_fnc_exchangeSystemSRV",2]call life_fnc_MP;waitUntil{uiSleep 0.1;life_exchangeStorageRequested};};while{dialog}do{closeDialog 0};disableSerialization;["exchangeStorage"]call life_fnc_createDialog;private _asy_display=findDisplay 876000;private _menuTitle=_asy_display displayCtrl 876002;private _mainFilterList=_asy_display displayCtrl 876003;private _mainListGroup=_asy_display displayCtrl 876005;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _rightListGroup=_asy_display displayCtrl 876007;private _rightItemList=_rightListGroup controlsGroupCtrl 1000;private _retrieveButton=_mainListGroup controlsGroupCtrl 1001;private _relistButton=_rightListGroup controlsGroupCtrl 1001;_mainFilterList lbSetCurSel 0;_menuTitle ctrlSetText(format["%1's Exchange Storage",profileName,(getPlayerUID player)]);{_x params["_title"];private _index=_mainFilterList lbAdd _title;_mainFilterList lbSetData[_index,_title];}forEach["Purchased Listings","Failed/Retracted Listings"];{_x lnbAddColumn 0.70}forEach[_mainItemList];if((lbSize _mainFilterList)<=1) then{_mainFilterList ctrlShow false;private _mainFilterListPosition=ctrlPosition _mainFilterList;private _controls=((allControls _asy_display) select{((ctrlParentControlsGroup _x) isEqualTo _mainListGroup)&&!((ctrlIDC _x) in[1000,1002,1003])});_mainListGroup ctrlSetPosition[_mainFilterListPosition select 0,_mainFilterListPosition select 1];{_x ctrlSetPosition[(ctrlPosition _x) select 0,((ctrlPosition _x) select 1)+(_mainFilterListPosition select 3)+0.0055]}forEach _controls;{_x ctrlSetPosition[(ctrlPosition _x) select 0,(ctrlPosition _x) select 1,(ctrlPosition _x) select 2,((ctrlPosition _x) select 3)+(_mainFilterListPosition select 3)+0.0055]}forEach[_mainItemList,_mainItemListBackground];