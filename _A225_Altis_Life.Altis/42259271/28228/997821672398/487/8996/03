#include"..\..\..\..\..\macro.h"
if(scriptAvailable(3)) exitWith{["Please don't spam vehicle purchases!","basic"]spawn life_fnc_handleMessage;};if(life_garageCount isEqualTo-1) exitWith{["Please try this vehicle purchase in a few seconds. Failed to fetch garage count from server.","basic"]spawn life_fnc_handleMessage;};if(life_garageCount>=(call life_maxGarageVeh)) exitWith{[format["You have %1 out of %2 max vehicles allowed in your garage.",life_garageCount,(call life_maxGarageVeh)],"basic"]spawn life_fnc_handleMessage;};if((lbCurSel 100102) isEqualTo-1) exitWith{["You did not select a vehicle to purchase!","basic"]spawn life_fnc_handleMessage;};private _display=findDisplay 100100;private _classname=lbData[100102,lbCurSel 100102];private _vehCfgRow=["getVehicleRowParsed","",_classname]call life_fnc_vehicleConfig;private _vehPrice=_vehCfgRow param[7,1000];private _price=if(ctrlChecked(_display displayCtrl 100106)) then{_vehPrice+500}else{_vehPrice};private _alarm=if(ctrlChecked(_display displayCtrl 100106)) then{1}else{0};private _skinID=if(lbSize 100105 isEqualTo 0) then{-1}else{lbValue[100105,lbCurSel 100105]};private _selText=lbText[100105,lbCurSel 100105];private _purchaseButton=_display displayCtrl 100107;private _bloodMoneyBuy=life_bloodMoneyShop;_price=_price+(_price*(call life_fnc_getGovTax));private _ownAndInFortress=([["gang_fortress_marker"],400,player]call life_fnc_inZone)&&(((gang_fortress_flag getVariable["ga_gang_fortress_data",[-1,"Unknown",false,"Unknown",grpNull]]) param[0,-1]) isEqualTo(life_gang_data param[0,-1]));_price=if(_ownAndInFortress) then{_price-(_price*0.15)}else{_price};_purchaseButton ctrlEnable false;life_veh_shop params["_shopVar","_spawnPoints","_shopFlag",""];private _isSwat=_shopVar isEqualTo"swat_car";private _isFirefighter=_shopVar isEqualTo"firefighter_car";private _isSRT=_shopVar isEqualTo"srt_car";private _vehCount=count(vehicles select{(_x getVariable["ga_isSwat",false])||(_x getVariable["ga_isFirefighter",false])||(_x getVariable["ga_isSRT",false])});private _maxVehicles=if((ASY_Server isEqualTo 2)&&(call life_fnc_isDominationActive)) then{5}else{3};if(_vehCount>=_maxVehicles&&_isSwat) exitWith{closeDialog 0;["The maximum amount of SWAT vehicles have been pulled.","basic"]spawn life_fnc_handleMessage;};if(_vehCount>=_maxVehicles&&_isFirefighter) exitWith{closeDialog 0;["The maximum amount of Firefighting vehicles have been pulled.","basic"]spawn life_fnc_handleMessage;};if(_vehCount>=_maxVehicles&&_isSRT) exitWith{closeDialog 0;["The maximum amount of SRT vehicles have been pulled.","basic"]spawn life_fnc_handleMessage;};if((_classname isEqualTo"O_APC_Wheeled_02_rcws_v2_F")&&(count(vehicles select{typeOf _x isEqualTo"O_APC_Wheeled_02_rcws_v2_F"}) isNotEqualTo 0)) exitWith{closeDialog 0;["The maximum amount of Madrids have been pulled.","basic"]spawn life_fnc_handleMessage;};if((_classname isEqualTo"B_G_Offroad_01_armed_F")&&(call life_fnc_isDominationActive)) exitWith{closeDialog 0;["This vehicle is currently disabled!","basic"]spawn life_fnc_handleMessage;};private _spawnPoint="";if(_spawnPoints isEqualType[]) then{if(!(call life_fnc_isDominationActive)) then{if(_classname isKindOf"Land") then{_spawnPoints=_spawnPoints select{"_g_"in(str _x)}};if(_classname isKindOf"Air") then{_spawnPoints=_spawnPoints select{"_air_"in(str _x)}};if(_classname isKindOf"Ship") then{_spawnPoints=_spawnPoints select{"_sea_"in(str _x)}};};if((_spawnPoints param[0,objNull]) isEqualType objNull) then{if!(surfaceIsWater position player) then{_spawnPoint=_spawnPoints param[_spawnPoints findIf{nearestObjects[getPosATL _x,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getPosATL _x,["Air"],14]isEqualTo[]&&(player distance2D(getPosATL _x)<=100)},""];}else{_spawnPoint=_spawnPoints param[_spawnPoints findIf{nearestObjects[getPosASL _x,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getPosASL _x,["Air"],14]isEqualTo[]&&(player distance2D(getPosASL _x)<=100)},""];};}else{_spawnPoint=_spawnPoints param[_spawnPoints findIf{nearestObjects[getMarkerPos _x,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getMarkerPos _x,["Air"],14]isEqualTo[]},""];}}else{if(_spawnPoints isEqualType"") then{if(nearestObjects[getMarkerPos _spawnPoints,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getMarkerPos _spawnPoints,["Air"],14]isEqualTo[]) then{_spawnPoint=_spawnPoints};}else{if(nearestObjects[getPosATL _spawnPoints,["Car","Ship"],5]isEqualTo[]&&nearestObjects[getPosATL _spawnPoints,["Air"],14]isEqualTo[]) then{_spawnPoint=_spawnPoints};