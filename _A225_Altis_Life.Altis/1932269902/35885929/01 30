private _capReward=20000;A_stats_dominationStatsSRT set[2,(A_stats_dominationStatsSRT param[2,0])+1];["srtdominationuncaps",1]call life_fnc_statArrUpdate;life_dominationStatCache pushBack[getPlayerUID player,profileName,"SRT",(life_gang_data param[0,-1]),"capture",1];[[0,1,2],format["You were awarded $%1 for uncapping %2!",[_capReward]call life_fnc_numberText,_defaultFlagName]]spawn life_fnc_broadcast;life_atmcash=life_atmcash+_capReward;life_atmcashCache=((life_atmcash/4)+5);[1]call life_fnc_ClUpdatePartial;["srtUncap",[format["%1 increased by 1",toUpper"SRT UNCAPS"]]]call BIS_fnc_showNotification;};case("unCapPoint"):{_srtData params[["_captureFlagObj",objNull,[objNull]]];private _getSrtMembers={allPlayers select{side _x isEqualTo west}};if(playerSide isNotEqualTo west) exitWith{};if!(call life_fnc_isDominationActive) exitWith{};if(life_dominationCapturingFlag) exitWith{};(_captureFlagObj getVariable["ga_domination_data",[-1,"Unknown"]]) params[["_gangID",-1,[0]],["_gangName","Unknown",[""]]];if(_gangID isEqualTo-1) exitWith{["No gang is in control of this capture point!","basic"]spawn life_fnc_handleMessage;};private _friendlyInArea=call _getSrtMembers;if(count _friendlyInArea>10) exitWith{["Capture Points can't be uncapped with more than 10 SRT members in the warzone!","basic"]spawn life_fnc_handleMessage;};life_dominationCapturingFlag=true;disableSerialization;5 cutRsc["life_progress","PLAIN"];private _display=uiNameSpace getVariable["life_progress",displayNull];private _progressBar=_display displayCtrl 38201;private _progressText=_display displayCtrl 38202;private _increment=1;private _totalTime=20;private _currentPoint=0;private _loopDelay=_totalTime/floor(100/_increment);private _defaultFlagName=["Capture Point: Alpha","Capture Point: Bravo","Capture Point: Charlie","Capture Point: Delta"]param[domination_flags find _captureFlagObj,"Capture Point"];private _text=format["Uncapping %1",_defaultFlagName];private _pos=getPosATL _captureFlagObj;private _startCount=0;_progressBar progressSetPosition _startCount;_progressText ctrlSetText format["%1 (%2%3)",_text,_startCount,"%"];private _isSuccess=for"_i"from 0 to 1 step 0 do{uiSleep _loopDelay;if(isNull _progressBar) exitWith{["You have failed to cap!","basic"]spawn life_fnc_handleMessage;false};_currentPoint=(progressPosition _progressBar)+(_increment/100);_progressBar progressSetPosition _currentPoint;_progressText ctrlSetText format["%1 (%2%3)",_text,round(_currentPoint*100),"%"];private _checkToExit=!(call life_fnc_isDominationActive);private _friendlyInArea=call _getSrtMembers;private _hasTooManyPlayers=(count _friendlyInArea>10);private _capperID=(_captureFlagObj getVariable["ga_domination_data",[-1,"Unknown"]]) param[0,-1,[0]];if(_capperID isEqualTo-1) exitWith{false};if(player distance _pos>8||life_isDowned||player getVariable["ga_restrained",false]||!alive player) exitWith{false};if(_checkToExit) exitWith{false};if(_hasTooManyPlayers) exitWith{["Capture points during domination can't be captured with more than 10 friendlys in the warzone!","basic"]spawn life_fnc_handleMessage;false};if!(isNull objectParent player) exitWith{false};if(_currentPoint>=1) exitWith{true};false;};life_dominationCapturingFlag=false;5 cutText["","PLAIN"];if!(_isSuccess) exitWith{};private _allSrtOfficers=call _getSrtMembers;private _warzonePlayers=allPlayers select{(getPos _x inPolygon life_dominationPoly)&&(side _x isEqualTo civilian)};_captureFlagObj setVariable["ga_domination_data",[-1,"Uncontrolled",grpNull],true];private _xMarkerIDX=(domination_flags find _captureFlagObj)+1;private _xMarker=format["domination_cap_%1",_xMarkerIDX];_xMarker setMarkerText format["%1 - %2",_defaultFlagName,"Uncapped"];[[3,format["%1 has been sacked and uncapped by SRT!",_defaultFlagName]],"life_fnc_broadcast",_warzonePlayers]spawn life_fnc_MP;[["uncappedPoint",[_captureFlagObj]],"life_fnc_dominationSRT",_allSrtOfficers]spawn life_fnc_MP;};};