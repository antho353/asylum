#include"..\..\..\macro.h"
if(scriptAvailable(8)) exitWith{["You can only grab the rubber out so quick...","basic"]spawn life_fnc_handleMessage;};params["_target","_caller","",""];if(isNull _target) exitWith{[[1,_caller],"TON_fnc_hackDetection",2]call life_fnc_MP;};if(_target isEqualTo _caller) exitWith{[[2,_caller],"TON_fnc_hackDetection",2]call life_fnc_MP;};if(isNull oil_flag) exitWith{};if!(alive player) exitWith{};private _flagData=oil_flag getVariable["ga_capData",[0,"Neutral",0.5]];private _rubberCount=oil_flag getVariable["ga_cap_oil",-1];_flagData params[["_ownerID",-1],["_ownerName",""],["_progress",-1]];if(life_gang_data isEqualTo[]) exitWith{};if(_ownerName isEqualTo""||_ownerID isEqualTo-1||_progress isEqualTo-1||_rubberCount isEqualTo-1) exitWith{};if((player distance2D oil_flag)>8) exitWith{["You need to stay by the flag to retrieve the rubber!","basic"]spawn life_fnc_handleMessage;};if(_rubberCount isEqualTo 0) exitWith{["There is no rubber in the container to grab!","basic"]spawn life_fnc_handleMessage;};life_gang_data params[["_myGangID",-1,[0]],["_myGangName","",[""]],["_myGangRank",-1,[0]]];if(_myGangID isEqualTo-1||_myGangName isEqualTo"") exitWith{};if(!(_myGangID isEqualTo _ownerID)||!(_myGangName==_ownerName)) exitWith{["You do not own the cartel!","basic"]spawn life_fnc_handleMessage;};if(_myGangName==_ownerName&&!(_progress isEqualTo 1)) exitWith{["You need to fully capture the cartel to retrieve rubber!","basic"]spawn life_fnc_handleMessage;};private _nearUnits=(nearestObjects[player,["Man"],10]) arrayIntersect playableUnits;if(count _nearUnits>1) exitWith{["You cannot pull out rubber while another player is near the flag!","basic"]spawn life_fnc_handleMessage;