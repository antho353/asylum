params[["_shopType","",[""]],["_controlData",[],[[]]]];if(_shopType isEqualTo"") exitWith{};if(_controlData isEqualTo[]) exitWith{};_controlData params["_control","_selectedIndex"];if(_selectedIndex isEqualTo-1) exitWith{};private _display=findDisplay 39400;if(isNull _display) exitWith{};private _itemPreview=_display displayCtrl 39403;private _mainListGroup=_display displayCtrl 39404;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListButton=_mainListGroup controlsGroupCtrl 1001;private _sideListGroup=_display displayCtrl 39405;private _sideItemList=_sideListGroup controlsGroupCtrl 1000;private _sideItemListButton=_sideListGroup controlsGroupCtrl 1001;private _filterType=_control lbData _selectedIndex;private _allItems=([_shopType]call life_fnc_weaponShopCfg) select 1;private _listItems=_allItems select{(toLower _filterType) isEqualTo(toLower(([_x select 0]call BIS_fnc_itemType) select 0))};private _discount=[_shopType,true]call life_fnc_getDiscount;_mainItemList ctrlSetFade 1.00;_mainItemList ctrlCommit 0.00;{_x lbSetCurSel-1}forEach[_mainItemList,_sideItemList];{lbClear _x}forEach[_mainItemList,_sideItemList];{_x ctrlEnable false}forEach[_mainItemListButton,_sideItemListButton];private _ownAndInFortress=([["gang_fortress_marker"],400,player]call life_fnc_inZone)&&(((gang_fortress_flag getVariable["ga_gang_fortress_data",[-1,"Unknown",false,"Unknown",grpNull]]) param[0,-1]) isEqualTo(life_gang_data param[0,-1]));{_x params[["_class",""],["_name",""],["_price",0]];if!(_class isEqualTo"") then{([_class]call life_fnc_fetchCfgDetails) params["_class","_displayName","_picture"];_displayName=if!(_name isEqualTo"") then{_name}else{_displayName};if(_displayName isEqualTo"") exitWith{};