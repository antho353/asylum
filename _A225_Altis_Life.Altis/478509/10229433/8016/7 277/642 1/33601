params[["_caseType","",[""]],["_trialData",[],[[]]]];if(_caseType isEqualTo""||_trialData isEqualTo[]) exitWith{};switch(_caseType) do{case"defendantRequestTrial":{_trialData params[["_defendant",objNull,[objNull]]];if(((A_stats_crimes) select 0)<=25000) exitWith{["You must have a bounty over $25,000 to request a trial","basic"]spawn life_fnc_handleMessage};if(profileNameSpace getVariable["ga_requestedTrial",false]) exitWith{["You have already requested a trial!","basic"]spawn life_fnc_handleMessage};if(SRV_trialData select 4) exitWith{["Another trial is already in process and the courts are at capacity. Try again shortly.","basic"]spawn life_fnc_handleMessage};if((SRV_trialData select 0) isEqualTo player) exitWith{["You currently already have a trial active!","basic"]spawn life_fnc_handleMessage};if!((SRV_trialData select 0) isEqualTo objNull) exitWith{["Another trial is already in process. Try again shortly.","basic"]spawn life_fnc_handleMessage};if((life_jailReleaseTime-time)<720) exitWith{["You must have at least 12 minutes left of your serving time to request a trial","basic"]spawn life_fnc_handleMessage};if((getPlayerUID player) in SRV_trialPreviousDefenders) exitWith{["You have already requested a trial this server restart!","basic"]spawn life_fnc_handleMessage};profileNameSpace setVariable["ga_requestedTrial",true];["Your trial request has been submitted. It may take as long as 5 minutes before you receive word concerning the trial.","basic"]spawn life_fnc_handleMessage;[["startTrial",[player,(A_stats_crimes select 0)]],"TON_fnc_trialSystemSRV",2]spawn life_fnc_MP;};case"juryInviteToTrial":{_trialData params[["_defendant",objNull,[objNull]]];life_clientTrialData set[1,true];["GovMessage",["You have received a Jury Summons!"]]call BIS_fnc_showNotification;{_x params["_timeDelayM","_timeDelayS"];if(SRV_trialData isEqualTo[objNull,[],[],false,false,false,""]) exitWith{};private _formatMinunteStr=if(_forEachIndex isEqualTo 2) then{format["%1 minute",_timeDelayM]}else{format["%1 minutes",_timeDelayM]};[format["<t color='#00FF00'><t size='1.5'><t align='center'>Jury Summons<br/><br/><t align='left'><t size='1'><t color='#ffffff'>You have been summoned to jury duty for the case of %2 v. %1! You will be <t color='#00FF00'>rewarded with $5,000</t>. Sign in at the nearest <t color='#00FF00'>courthouse</t> within %3 to attend.",worldName,name _defendant,_formatMinunteStr],"basic"]spawn life_fnc_handleMessage;uiSleep _timeDelayS;}forEach[[5,180],[2,60],[1,60]];[]spawn{uiSleep 300;life_clientTrialData set[1,false];};};case"registerForJury":{if!(vehicle player isEqualTo player) exitWith{["You cannot register for jury duty while restrained!","basic"]spawn life_fnc_handleMessage};if(player getVariable["ga_restrained",false]) exitWith{["You cannot register for jury duty from within a vehicle.","basic"]spawn lifqe_fnc_handleMessage};if(SRV_trialData select 5) exitWith{["The courtroom has already reached its max capacity!","basic"]spawn life_fnc_handleMessage};if!(life_clientTrialData select 1) exitWith{["You haven't been chosen for jury duty yet!","basic"]spawn life_fnc_handleMessage};if(life_clientTrialData select 3) exitWith{["You are currently waiting for a courtroom to be in session, please be patient!","basic"]spawn life_fnc_handleMessage};private _startPos=getPos player;life_clientTrialData set[3,true];[["addJuryPlayer",[player,"add"]],"TON_fnc_trialSystemSRV",2]spawn life_fnc_MP;["You have registered for jury duty! Please wait up to 5 minutes for the court to be in session","basic"]spawn life_fnc_handleMessage;waitUntil{uiSleep 5;((SRV_trialData select 0) isEqualTo objNull)||(SRV_trialData select 4)||(player distance _startPos>=25)||player getVariable["ga_restrained",false]||!(vehicle player isEqualTo player)};if(SRV_trialData select 0) exitWith{["Jury duty has been cancelled!"]spawn life_fnc_handleMessage;life_clientTrialData set[3,false];};if(count(SRV_trialData select 1) isEqualTo 12) exitWith{["The courtroom has already reached its max capacity!","basic"]spawn life_fnc_handleMessage;life_clientTrialData set[3,false];};if((player distance _startPos>=25)||player getVariable["ga_restrained",false]||!(vehicle player isEqualTo player)) exitWith{[["addJuryPlayer",[player,"remove"]],"TON_fnc_trialSystemSRV",2]spawn life_fnc_MP;life_clientTrialData set[3,false];["You moved too far from the courthouse, entered a vehicle, or have been restrained. You have been removed from the jury bench as a result. Quickly register for duty again before the trial begins if you wish to attend."]spawn life_fnc_handleMessage;};};case"defendantTrialStart":{_trialData params[["_defendant",objNull,[objNull]],["_positionData",[],[[]]]];_positionData params["_asy_pos","_asy_dir"];[[0,1,2],"Your trial has begun. You have three minutes to convince the jury of your innocence. Good luck."]spawn life_fnc_broadcast;life_clientTrialData set[0,true];private _asy_obj=player;_asy_obj setDir _asy_dir;_asy_obj setPosASL _asy_pos;[player,player,true,false]spawn life_fnc_restrainAction;disableSerialization;5 cutRsc["life_progress","PLAIN"];private _display=uiNameSpace getVariable["life_progress",displayNull];private _progressBar=_display displayCtrl 38201;private _progressText=_display displayCtrl 38202;private _increment=1;private _totalTime=180;private _currentPoint=0;private _loopDelay=_totalTime/floor(100/_increment);private _text=format["Plead your innocence to the Jury"];private _startCount=0;_progressBar progressSetPosition _startCount;_progressText ctrlSetText format["%1 (%2%3)",_text,_startCount,"%"];private _isSuccess=for"_i"from 0 to 1 step 0 do{uiSleep _loopDelay;_currentPoint=(progressPosition _progressBar)+(_increment/100);_progressBar progressSetPosition _currentPoint;