private _doubleClickItem={params[["_control",controlNull],["_selectedIndex",-1]];if(_selectedIndex isEqualTo-1) exitWith{};if(isNull _control) exitWith{};private _asy_display=findDisplay 39500;if(isNull _asy_display) exitWith{};private _mainListGroup=_asy_display displayCtrl 39503;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListEdit=_mainListGroup controlsGroupCtrl 1004;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;if((lbCurSel _mainItemList) isEqualTo-1) exitWith{};private _selectedData=[_mainItemList lnbData[_selectedIndex,0],_mainItemList lnbValue[_selectedIndex,1],_mainItemList lnbValue[_selectedIndex,2]];_selectedData params["_itemName","_itemPrice","_itemInvAmount"];private _currentQty=missionNamespace getVariable(format["life_inv_%1",_itemName]);if!(_currentQty isEqualTo _itemInvAmount) exitWith{_mainItemListEdit ctrlSetText"1"};_mainItemListEdit ctrlSetText format["%1",_itemInvAmount];};private _clickSelectedItem={params[["_control",controlNull],["_selectedIndex",-1],["_shopType",""]];if(_selectedIndex isEqualTo-1) exitWith{};if(isNull _control) exitWith{};if(_shopType isEqualTo"") exitWith{};private _asy_display=findDisplay 39500;if(isNull _asy_display) exitWith{};private _mainListGroup=_asy_display displayCtrl 39503;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBuyButton=_mainListGroup controlsGroupCtrl 1005;private _mainItemListSellButton=_mainListGroup controlsGroupCtrl 1006;{_x ctrlEnable false}forEach[_mainItemListBuyButton,_mainItemListSellButton];private _shopInfo=[_shopType]call life_fnc_virt_shops;_shopInfo params[["_shopTitle",""],["_buyItems",[]],["_sellItems",[]]];private _selectedData=[_mainItemList lnbData[_selectedIndex,0],_mainItemList lnbValue[_selectedIndex,1],_mainItemList lnbValue[_selectedIndex,2]];_selectedData params["_itemName","_itemPrice","_itemInvAmount"];if((_control isEqualTo _mainItemList)&&!(_selectedIndex isEqualTo-1)) then{if(_itemName in _buyItems) then{_mainItemListBuyButton ctrlEnable true;};if((_itemName in _sellItems)&&(_itemInvAmount>=1)) then{_mainItemListSellButton ctrlEnable true;_mainItemListBuyButton ctrlEnable true;};if((ctrlEnabled _mainItemListBuyButton)&&!(_itemName in _buyItems)) then{_mainItemListBuyButton ctrlEnable false;};};};params["_target","_caller","_actionID",["_shopType","",[""]]];if(_shopType isEqualTo"") exitWith{};if!((vehicle player) isEqualTo player) exitWith{["This action cannot be performed from within a vehicle.","basic"]spawn life_fnc_handleMessage;};if((player distance _target)>=10) exitWith{["You are too far away.","basic"]spawn life_fnc_handleMessage;};if(lineIntersects[eyePos player,aimPos _target,player,_target]) exitWith{["It would be hard to buy things through the wall, don't you think?","basic"]spawn life_fnc_handleMessage;};if(player getVariable["ga_restrained",false]) exitWith{};if(player getVariable["ga_surrendered",false]) exitWith{};["life_virtual_shop"]call life_fnc_createDialog;private _asy_display=findDisplay 39500;if(isNull _asy_display) exitWith{};if((_shopType=="heroin")&&((time-life_last_wanted)>240)&&(playerSide isEqualTo civilian)&&!(call life_fnc_isDominationActive)) then{life_last_wanted=time;private _toSend=allPlayers select{_x distance player<=4000&&side _x isEqualTo west};if!(_toSend isEqualTo[]) then{[[8,profileName,str(A_stats_crimes select 0),player],"life_fnc_clientMessage",_toSend,false,false]spawn life_fnc_MP;};};if(_shopType=="wongs") then{private _pointData=wongs_flag getVariable["ga_capData",[0,"Neutral",-1]];_pointData params["_flagGangID","","_progress"];if(_flagGangID isEqualTo 0) exitWith{};life_wongsCartel=[false,0,_flagGangID];if((_flagGangID isEqualTo(life_gang_data param[0,-2]))&&(_progress>=0)) then{life_wongsCartel set[0,true];};};if(_shopType=="rebel") then{private _pointData=arms_flag getVariable["ga_capData",[0,"Neutral",-1]];_pointData params["_flagGangID","","_progress"];if(_flagGangID isEqualTo 0) exitWith{};life_armsCartel=[false,0,_flagGangID];if((_flagGangID isEqualTo(life_gang_data param[0,-2]))&&(_progress>=0)) then{life_armsCartel set[0,true];};};private _inTurf=(player inArea"turf_area_rodo_flag"||player inArea"turf_area_panagia_flag"||player inArea"turf_area_zaros_flag");if(_shopType isEqualTo"heroin"&&_inTurf) then{private _nearestFlag=(nearestObjects[player,["Flag_Red_F","FlagPole_F"],500]select 0);(_nearestFlag getVariable["ga_turf_data",[]]) params["_flagGangID"];if(_flagGangID isEqualTo 0) exitWith{};life_turfTax=[false,0,_flagGangID];if(_flagGangID isEqualTo(life_gang_data param[0,-2])) then{life_turfTax set[0,true];};};private _topTitle=_asy_display displayCtrl 39501;private _subTitle=_asy_display displayCtrl 39502;private _mainListGroup=_asy_display displayCtrl 39503;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListEdit=_mainListGroup controlsGroupCtrl 1004;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _mainItemListBuyButton=_mainListGroup controlsGroupCtrl 1005;private _mainItemListSellButton=_mainListGroup controlsGroupCtrl 1006;private _shopTitle=([_shopType]call life_fnc_virt_shops) select 0;_topTitle ctrlSetText(format["%1",_shopTitle]);_subTitle ctrlSetText(format["Shop Inventory - Weight: %2/%3",_shopTitle,life_carryWeight,life_maxWeight]);{_x lnbAddColumn 0.425;_x lnbAddColumn 0.7;}forEach[_mainItemList];{private _headerInfo=[["Name",false],["Price",true],["Inv Amount",false]];private _idx=_forEachIndex;private _itemListGroup=_x;private _itemList=_x controlsGroupCtrl 1000;private _itemListWidth=(ctrlPosition _itemList) select 2;private _columnPositions=lnbGetColumnsPosition _itemList;