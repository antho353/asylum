#include"..\..\macro.h"
if(scriptAvailable(5)) exitWith{["Please don't spam Prison Breaks!","basic"]spawn life_fnc_handleMessage;};params[["_target",objNull,[objNull]]];if(life_action_in_use) exitWith{systemChat"You are already performing an action.";};if!(playerSide isEqualTo civilian) exitWith{};if([]call life_fnc_activeFederalEvent) exitWith{["There is already another Federal Event happening.","basic"]spawn life_fnc_handleMessage;};if!([4]call life_fnc_policeRequired) exitWith{};if(player getVariable["ga_restrained",false]||player getVariable["ga_downed",false]||player getVariable["ga_arrested",false]) exitWith{};private _prisonerCount=count(allPlayers select{side _x isEqualTo civilian&&_x getVariable["ga_arrested",false]});if(_prisonerCount isEqualTo 0) exitWith{["A prison break requires prisoners to be in the prison.","basic"]spawn life_fnc_handleMessage;};if(serverTime-life_lastPrison<1800) exitWith{["This prison is on lockdown. Try again in a few minutes.","basic"]spawn life_fnc_handleMessage;};if((currentWeapon player) in["","Binocular","Rangefinder","hgun_Pistol_Signal_F"]) exitWith{["The prison guards will not be very intimidated by an unarmed civilian!","basic"]spawn life_fnc_handleMessage;};if(life_prison_inProgress) exitWith{["There is already a prison break in progress!","basic"]spawn life_fnc_handleMessage;};if((player distance _target)>10) exitWith{["You need to stay near the laptop to complete the virus upload!","basic"]spawn life_fnc_handleMessage;};if!(isNull objectParent player) exitWith{};if(SRV_lastRobbery>(serverTime-(60*15))) exitWith{[2,format["Security is high due to a recent robbery and you cannot start the prison break. Try again in %1 minute(s).",ceil((SRV_lastRobbery-(serverTime-(60*15)))/60)]]call life_fnc_broadcast};