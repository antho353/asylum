params["_data"];_data params[["_classname","",[""]],"_plate","_color","_insured",["_mods",[0,0,0,0],[[]]],["_vehWear",[0,0,0],[[]]],["_customPlate","",[""]]];["ASY_garageMods"]call life_fnc_createDialog;disableSerialization;waitUntil{uiSleep 0.01;!isNull(findDisplay 100210)};private _asy_display=findDisplay 100210;private _currentMods=_asy_display displayCtrl 100151;private _trunkCombo=_asy_display displayCtrl 100152;private _skinCombo=_asy_display displayCtrl 100153;private _hornCombo=_asy_display displayCtrl 100154;private _handlingCombo=_asy_display displayCtrl 100155;private _alarmCombo=_asy_display displayCtrl 100156;private _licensePlate=_asy_display displayCtrl 100157;private _licenseText=_asy_display displayCtrl 100158;private _saveButton=_asy_display displayCtrl 100160;private _backButton=_asy_display displayCtrl 100161;private _costText=_asy_display displayCtrl 100162;_trunkCombo ctrlEnable false;_hornCombo ctrlEnable false;_handlingCombo ctrlEnable false;_alarmCombo ctrlEnable false;_skinCombo ctrlEnable false;_licensePlate ctrlEnable false;_costText ctrlSetText"$0";if(count _mods<4) then{private _toAdd=4-(count _mods);for[{_x=1},{_x<=_toAdd},{_x=_x+1}]do{_mods pushBack 0;};};_mods params["_vehAlarm","_trunkMod","_handlingMod","_hornMod"];_mods pushBack _color;_mods pushBack _customPlate;life_modShopVehicle=[_classname,_plate];life_modShopMods=+_mods;life_modShopChanges=+_mods;life_modShopCosts=[0,0,0,0,0,0];{_trunkCombo lbAdd(_x select 0);_trunkCombo lbSetValue[_forEachIndex,(_x select 1)];}forEach[["Base Storage - $0",0],["+50 Storage - $5,000",50],["+75 Storage - $7,500",75],["+100 Storage - $10,000",100]];{if(_trunkMod isEqualTo _x) then{_trunkCombo lbSetCurSel _forEachIndex};}forEach[0,50,75,100];_trunkCombo ctrlAddEventHandler["LBSelChanged",{params[["_trunkComboBox",controlNull],["_selectedIndex",-1]];if(isNull _trunkComboBox) exitWith{};disableSerialization;private _asy_display=ctrlParent _trunkComboBox;if(isNull _asy_display) exitWith{};private _costText=_asy_display displayCtrl 100162;if((_trunkComboBox lbValue _selectedIndex)>(life_modShopMods select 1)) then{private _cost=switch(_trunkComboBox lbValue _selectedIndex) do{case 0:{0};case 50:{5000};case 75:{7500};case 100:{10000};default{2500};};life_modShopCosts set[1,_cost];}else{life_modShopCosts set[1,0];};life_modShopChanges set[1,_trunkComboBox lbValue _selectedIndex];private _saveButton=_asy_display displayCtrl 100160;private _licensePlate=ctrlText(_asy_display displayCtrl 100157);if([_licensePlate]call life_fnc_checkPlate) then{life_modShopCosts set[4,2500];_saveButton ctrlEnable true;}else{life_modShopCosts set[4,0];_saveButton ctrlEnable false;};if(_licensePlate isEqualTo"") then{life_modShopCosts set[4,0];_saveButton ctrlEnable true;};life_modShopChanges set[5,_licensePlate];private _total=0;{_total=_total+_x}forEach life_modShopCosts;_costText ctrlSetText format["$%1",[_total]call life_fnc_numberText];}];_licensePlate ctrlAddEventHandler["KeyUp",{params["_control"];disableSerialization;private _asy_display=ctrlParent _control;private _costText=_asy_display displayCtrl 100162;private _saveButton=_asy_display displayCtrl 100160;private _licensePlate=ctrlText _control;if([_licensePlate]call life_fnc_checkPlate) then{life_modShopCosts set[4,2500];_saveButton ctrlEnable true;}else{life_modShopCosts set[4,0];_saveButton ctrlEnable false;};if(_licensePlate isEqualTo"") then{life_modShopCosts set[4,0];_saveButton ctrlEnable true;};life_modShopChanges set[5,_licensePlate];private _total=0;{_total=_total+_x}forEach life_modShopCosts;_costText ctrlSetText format["$%1",[_total]call life_fnc_numberText];}];private _availableHorns=[1]call life_fnc_hornCfg;{_hornCombo lbAdd format["%1 - $%2",_x select 1,[_x select 2]call life_fnc_numberText];_hornCombo lbSetValue[_forEachIndex,_x select 0];}forEach _availableHorns;_hornCombo ctrlAddEventHandler["LBSelChanged",{params[["_hornComboBox",controlNull],["_selectedIndex",-1]];if(isNull _hornComboBox) exitWith{};disableSerialization;private _asy_display=ctrlParent _hornComboBox;if(isNull _asy_display) exitWith{};private _availableHorns=[1]call life_fnc_hornCfg;private _costText=_asy_display displayCtrl 100162;private _hornID=_hornComboBox lbValue _selectedIndex;if!(_hornID isEqualTo(life_modShopMods select 3)) then{private _index=_availableHorns findIf{(_x select 0) isEqualTo _hornID};private _cost=(_availableHorns select _index) select 2;life_modShopCosts set[3,_cost];}else{life_modShopCosts set[3,0];};life_modShopChanges set[3,_hornComboBox lbValue _selectedIndex];private _saveButton=_asy_display displayCtrl 100160;private _licensePlate=ctrlText(_asy_display displayCtrl 100157);if([_licensePlate]call life_fnc_checkPlate) then{life_modShopCosts set[4,2500];_saveButton ctrlEnable true;}else{life_modShopCosts set[4,0];_saveButton ctrlEnable false;};if(_licensePlate isEqualTo"") then{life_modShopCosts set[4,0];_saveButton ctrlEnable true;};life_modShopChanges set[5,_licensePlate];private _total=0;{_total=_total+_x}forEach life_modShopCosts;_costText ctrlSetText format["$%1",[_total]call life_fnc_numberText];}];{_handlingCombo lbAdd(_x select 0);_handlingCombo lbSetValue[_forEachIndex,(_x select 1)];}forEach[["Stock Handling - $0",0],["Suspension Mod - $3,500",1],["Brakes and Suspension - $7,500",2]];_handlingCombo ctrlAddEventHandler["LBSelChanged",{params[["_handlingComboBox",controlNull],["_selectedIndex",-1]];