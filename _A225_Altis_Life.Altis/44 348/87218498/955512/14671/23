};_vehicle setVariable["ga_gettingClaimed",true,true];closeDialog 0;disableSerialization;5 cutRsc["life_progress","PLAIN"];private _ui=uiNamespace getVariable"life_progress";private _text="Claiming vehicle...";private _progress=_ui displayCtrl 38201;private _pgText=_ui displayCtrl 38202;_pgText ctrlSetText format["%2 (1%1)...","%",_text];_progress progressSetPosition 0.01;private _cP=0.01;life_action_in_use=true;private _success=false;private _startPos=getPosASL player;for"_i"from 0 to 1 step 0 do{uiSleep 0.6;_cP=_cP+0.01;_progress progressSetPosition _cP;_pgText ctrlSetText format["%3 (%1%2)...",round(_cP*100),"%",_text];if!(alive player) exitWith{};if!(alive _vehicle) exitWith{};if!(isNull objectParent player) exitWith{};if(player distance2D _startPos>2) exitWith{};if(player distance2D _vehicle>22) exitWith{};if(player getVariable["ga_downed",false]) exitWith{};if(player getVariable["ga_surrendered",false]) exitWith{};if!(life_action_in_use) exitWith{};if(_cp>=1) exitWith{_success=true;};};5 cutText["","PLAIN"];life_action_in_use=false;_vehicle setVariable["ga_gettingClaimed",false,true];if!(_success) exitWith{["The claiming process was interrupted.","basic"]spawn life_fnc_handleMessage;};private _keyHolders=(_vehicle getVariable["ga_vehicleOwnerUIDs",[["",""]]]) apply{_x select 0};private _toSend=(allPlayers select{(getPlayerUID _x) in _keyHolders})-[player];[[_vehicle],"life_fnc_removeVehKey",_toSend]spawn life_fnc_MP;[[_toSend,_vehicle,3],"TON_fnc_keyManagement",2]spawn life_fnc_MP;life_atmcash=life_atmcash-_claimPrice;life_atmcashCache=((life_atmcash/4)+5);[1]call life_fnc_ClupdatePartial;_vehicle setVariable["ga_dbInfo",[getPlayerUID player,_vehiclePlateID],true];_vehicle setVariable["ga_vehOwners",[[getPlayerUID player,profileName]],true];life_vehicles pushBackUnique _vehicle;titleText[format["You have claimed this vehicle for a price of $%1",[_claimPrice]call life_fnc_numberText],"PLAIN"];["vehclaim",1]call life_fnc_statArrUpdate;if(_isGang) then{[["-CHOPCLAIMGANGVEH-",player,(profileName),format["chop claimed a %1 (%2) for $%3, owned by gang ID: (%4) at POS: %5",(getText(configFile>>"CfgVehicles">>(typeOf _vehicle)>>"displayName")),_vehiclePlateID,[_claimPrice]call life_fnc_numberText,_vehicleOwnerUID,(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;}else{[["-CHOPCLAIM-",player,(profileName),format["chop claimed a %1 (%2) for $%3, owned by (%4) at POS: %5",(getText(configFile>>"CfgVehicles">>(typeOf _vehicle)>>"displayName")),_vehiclePlateID,[_claimPrice]call life_fnc_numberText,_vehicleOwnerUID,(getPos player)]],"TON_fnc_logIt",2,false,false]spawn life_fnc_MP;};[[player,getPlayerUID player,_vehicleOwnerUID,_vehiclePlateID,_isGang],"TON_fnc_vehOwnerSwap",2]spawn life_fnc_MP;if(typeOf _vehicle isEqualTo"O_MRAP_02_F") then{["claim","ifrit",1]call life_fnc_handleQuest;};