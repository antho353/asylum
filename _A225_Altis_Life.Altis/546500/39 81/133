#include"..\..\macro.h"
params[["_redeploy",false,[true]]];if(_redeploy&&ASY_Server isEqualTo 1&&{scriptAvailable(300)}) exitWith{closeDialog 0;["You can only redeploy once every 5 minutes!","basic"]spawn life_fnc_handleMessage;};private _exit=false;if(_redeploy&&!(call life_fnc_isDominationActive)) then{closeDialog 0;private _damage=damage player;private _startPos=getPos player;for"_i"from 1 to 15 step 1 do{if!(alive player) exitWith{_exit=true;};if!(isNull objectParent player) exitWith{_exit=true;["Redeploy aborted.","basic"]spawn life_fnc_handleMessage;};if(damage player>_damage) exitWith{_exit=true;["You took damage while attempting to deploy to a new loaction. Redeploy aborted.","basic"]spawn life_fnc_handleMessage;};if(player distance2D _startPos>10) exitWith{_exit=true;["You wandered off while attempting to deploy to a new location. Redeploy aborted.","basic"]spawn life_fnc_handleMessage;};titleText[format["Redeploying to %1 in %2 seconds...",life_spawn_point select 1,16-_i],"PLAIN"];uiSleep 1;titleText["","PLAIN"];life_copEviReq=nil;};};if(_exit) exitWith{closeDialog 0};if(call life_fnc_isDominationActive) then{if(life_inv_debitcard isEqualTo 0) then{[true,"debitcard",1]call life_fnc_handleInv;};[]call life_fnc_giveMedkits;};private _text=if(_redeploy) then{"You have deployed to"}else{"You have spawned at"};private _asy_pos=[0,0,0];private _marker=life_spawn_point param[0,""];if(life_sidechat&&(playerSide isEqualTo civilian)&&!(player in((radioChannelInfo life_radio_civ) param[3,[]]))) then{[life_sidechat]call life_fnc_manageSidechat;};if(life_spawn_point isEqualTo[]) then{private _spawnPoint=([playerSide]call life_fnc_spawnPointCfg) select 0;if((playerSide isEqualTo civilian)||(call life_fnc_isDominationActive)) then{private _spawnPos=selectRandom(missionNamespace getVariable _spawnPoint);_spawnPos=_spawnPos buildingPos 0;}else{private _marker=_spawnPoint select 0;if(playerSide isEqualTo west) then{_marker=format["%1_%2",_marker,floor random 4]};_asy_pos=getMarkerPos _marker;};titleText[format["%2 %1",_spawnPoint select 1,_text],"BLACK IN"];}else{if(playerSide isEqualTo civilian) then{switch(true) do{case("house"in _marker):{private _house=nearestObjects[getMarkerPos _marker,["House_F"],10]select 0;private _buildingPos=[_house]call life_fnc_getBuildingPositions;if(_buildingPos isEqualTo[]) exitWith{_asy_pos=getMarkerPos _marker;};_asy_pos=selectRandom _buildingPos;};case("safezone"in _marker):{_asy_pos=[[[getMarkerPos _marker,5]],[]]call BIS_fnc_randomPos;};default{private _houses=missionNamespace getVariable _marker;if(isNil"_houses") then{_asy_pos=getMarkerPos _marker;}else{_asy_pos=getPosATL(selectRandom _houses);};};};}else{if(playerSide isEqualTo west&&!(_marker in["armory_marker"])&&(ASY_Server isEqualTo 1)) then{_marker=format["%1_%2",_marker,floor random 4]};_asy_pos=getMarkerPos _marker;life_eviSpawn=false;if(playerSide isEqualTo west&&_marker isEqualTo"armory_marker"&&life_evidence_spawns<2) then{while{true}do{private _safePos=[getMarkerPos"armory_marker",25,195,3,0,0.2,0]call BIS_fnc_findSafePos;_safePos pushBack 0;if(_safePos inPolygon life_eviFencePoly) exitWith{_asy_pos=_safePos};};};if(_marker isEqualTo"armory_marker"&&life_evidence_spawns<2) then{private _loadouts=[[["arifle_MX_Black_F","","","optic_Arco_blk_F",["30Rnd_65x39_caseless_black_mag",30],[],""],[],["hgun_P07_F","muzzle_snds_L","","",["30Rnd_9x21_Mag",26],[],""],["U_Rangemaster",[["SmokeShellBlue",1,1]]],["V_PlateCarrier1_blk",[["30Rnd_556x45_Stanag",1,30],["30Rnd_9x21_Mag",1,30],["30Rnd_65x39_caseless_black_mag",8,30],["SmokeShellBlue",2,1],["MiniGrenade",3,1]]],["B_Bergen_blk",[["ToolKit",1],["30Rnd_65x39_caseless_black_mag",8,30]]],"H_Cap_police","",["Binocular","","","",[],[],""],["ItemMap","ItemGPS","","ItemCompass","ItemWatch","Integrated_NVG_F"]],[["arifle_MXM_Black_F","","","optic_Arco_blk_F",["30Rnd_65x39_caseless_black_mag",30],[],""],[],["hgun_P07_F","muzzle_snds_L","","",["30Rnd_9x21_Mag",26],[],""],["U_Rangemaster",[["SmokeShellBlue",1,1]]],["V_PlateCarrier1_blk",[["30Rnd_556x45_Stanag",1,30],["30Rnd_9x21_Mag",1,30],["30Rnd_65x39_caseless_black_mag",8,30],["SmokeShellBlue",2,1],["MiniGrenade",3,1]]],["B_Bergen_blk",[["ToolKit",1],["30Rnd_65x39_caseless_black_mag",8,30]]],"H_Cap_police","",["Binocular","","","",[],[],""],["ItemMap","ItemGPS","","ItemCompass","ItemWatch","Integrated_NVG_F"]],[["srifle_DMR_03_F","","","optic_Arco_blk_F",["20Rnd_762x51_Mag",20],[],""],[],[],["U_Rangemaster",[["20Rnd_762x51_Mag",3,20],["SmokeShellBlue",1,1]]],["V_PlateCarrier1_blk",[["20Rnd_762x51_Mag",11,20],["SmokeShellBlue",2,1]]],["B_FieldPack_blk",[["ToolKit",1],["20Rnd_762x51_Mag",1,20]]],"H_Cap_police","",["Binocular","","","",[],[],""],["ItemMap","ItemGPS","","ItemCompass","ItemWatch","Integrated_NVG_F"]],[["arifle_SPAR_01_blk_F","","","optic_Aco",["30Rnd_556x45_Stanag",30],[],""],[],["hgun_P07_F","muzzle_snds_L","","",["30Rnd_9x21_Mag",26],[],""],["U_Rangemaster",[["SmokeShellBlue",1,1]]],["V_TacVest_blk_POLICE",[["30Rnd_556x45_Stanag",9,30],["MiniGrenade",2,1],["1Rnd_SmokeBlue_Grenade_shell",1,1],["30Rnd_9x21_Mag",1,30]]],[],"H_Cap_police","",["Binocular","","","",[],[],""],["ItemMap","ItemGPS","","ItemCompass","ItemWatch","Integrated_NVG_F"]]];