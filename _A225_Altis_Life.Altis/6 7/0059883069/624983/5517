params["_target","_caller","_actionID",["_parameters","",["",[]]]];private _shopType=if!(_parameters isEqualType[]) then{_parameters}else{_parameters select 0};private _bloodMoneyShop=if!(_parameters isEqualType[]) then{false}else{_parameters select 1};if(_shopType isEqualTo"") exitWith{};if(isNull _target) exitWith{[[1,_caller],"TON_fnc_hackDetection",false,false]call life_fnc_MP;};if(_target isEqualTo _caller) exitWith{[[2,_caller],"TON_fnc_hackDetection",false,false]call life_fnc_MP;};if(player getVariable["ga_restrained",false]) exitWith{};if(player getVariable["ga_surrendered",false]) exitWith{};private _shopType=if(_shopType isEqualTo"police_weapons"&&(call life_fnc_isDominationActive)) then{"srt_weapons"}else{_shopType};["life_weapon_shop"]call life_fnc_createDialog;private _asy_display=findDisplay 39400;if(isNull _asy_display) exitWith{};if(_bloodMoneyShop) then{life_bloodMoneyShop=true;};private _preBloodMoney=life_bloodMoney;if!(_bloodMoneyShop) then{if(_shopType=="rebelwep") then{private _pointData=arms_flag getVariable["ga_capData",[0,"Neutral",-1]];_pointData params["_flagGangID","","_progress"];if(_flagGangID isEqualTo 0) exitWith{};life_armsCartel=[false,0,_flagGangID];if((count life_gang_data)>0) then{if((_flagGangID isEqualTo(life_gang_data select 0))&&(_progress>=0)) then{life_armsCartel set[0,true];};};};};private _title=_asy_display displayCtrl 39401;private _filterList=_asy_display displayCtrl 39402;private _mainListGroup=_asy_display displayCtrl 39404;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListButton=_mainListGroup controlsGroupCtrl 1001;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _sideListGroup=_asy_display displayCtrl 39405;private _sideItemList=_sideListGroup controlsGroupCtrl 1000;private _sideItemListButton=_sideListGroup controlsGroupCtrl 1001;private _sideItemListBackground=_sideListGroup controlsGroupCtrl 1003;private _titleText=([_shopType]call life_fnc_weaponShopCfg) select 0;if(_bloodMoneyShop) then{_titleText=_titleText+(format[" - %1 BM",life_bloodMoney])};_title ctrlSetText _titleText;{_x lnbAddColumn 0.70}forEach[_mainItemList,_sideItemList];{_x params[["_title",""],["_type",""]];private _allItems=([_shopType]call life_fnc_weaponShopCfg) select 1;private _listItems=_allItems select{(toLower _type) isEqualTo(toLower(([_x select 0]call BIS_fnc_itemType) select 0))};if((count _listItems)>=1) then{private _index=_filterList lbAdd _title;_filterList lbSetData[_index,_type];};}forEach[["Weapons","weapon"],["Throwables","magazine"],["Items","item"]];if((lbSize _filterList)<=1) then{_filterList ctrlShow false;private _filterListPosition=ctrlPosition _filterList;private _controls=((allControls _asy_display) select{((ctrlParentControlsGroup _x) isEqualTo _mainListGroup)&&!((ctrlIDC _x) in[1000,1002,1003])});_mainListGroup ctrlSetPosition[_filterListPosition select 0,_filterListPosition select 1];{_x ctrlSetPosition[(ctrlPosition _x) select 0,((ctrlPosition _x) select 1)+(_filterListPosition select 3)+0.0055]}forEach _controls;{_x ctrlSetPosition[(ctrlPosition _x) select 0,(ctrlPosition _x) select 1,(ctrlPosition _x) select 2,((ctrlPosition _x) select 3)+(_filterListPosition select 3)+0.0055]}forEach[_mainItemList,_mainItemListBackground];{_x ctrlCommit 0}forEach(allControls _asy_display);};private _headerInfo=[["Name",false],["Price",true]];{private _itemListGroup=_x;private _itemList=_x controlsGroupCtrl 1000;private _itemListWidth=(ctrlPosition _itemList) select 2;private _columnPositions=lnbGetColumnsPosition _itemList;{private _currentColumnPosition=_x*_itemListWidth;(_headerInfo select _forEachIndex) params[["_headerText",""],["_sortByValue",false]];private _nextColumnPosition=if!(_forEachIndex isEqualTo((count _columnPositions)-1)) then{_columnPositions select(_forEachIndex+1)}else{1};