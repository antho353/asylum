#include"..\..\macro.h"
if(scriptAvailable(10)) exitWith{["Please wait a few seconds to allow previous upgrades to finish!","basic"]spawn life_fnc_handleMessage;};if((life_cashCache!=((life_cash/4)+7))||(life_atmcashCache!=((life_atmcash/4)+5))) exitWith{[["-HACKEDMONEY-",player,profileName,format["File: %1 - money tampering attempted! Cash: %2 - Expected cash: %3 | Bank: %4 - Expected bank: %5.",_fnc_scriptName,[life_cash]call life_fnc_numberText,[((life_cashCache-7)*4)]call life_fnc_numberText,[life_atmCash]call life_fnc_numberText,[((life_atmCashCache-5)*4)]call life_fnc_numberText]],"TON_fnc_logIt",2]spawn life_fnc_MP;[[profileName,"Attempting to hack money variable."],"life_fnc_notifyAdmins",-2,false]spawn life_fnc_MP;["MemHackCash",false,false]call compile PreProcessFileLineNumbers"\a3\functions_f\Misc\fn_endMission.sqf";};params[["_property",objNull,[objNull]],["_mode","",[""]]];if(life_houseTxn) exitWith{["You currently have an active transaction, please wait.","basic"]spawn life_fnc_handleMessage;};if(isNull _property||_mode isEqualTo"") exitWith{};if!((_property getVariable["ga_homeOwner",""]) isEqualTo getPlayerUID player) exitWith{["You don't own this property.","basic"]spawn life_fnc_handleMessage;};private _houseCfg=[typeOf _property]call life_fnc_houseConfig;if(_houseCfg isEqualTo[]) exitWith{};_houseCfg params[["_buyPrice",-1],["_sellPrice",-1],["_physInv",[]],["_virtInv",[]]];if(_buyPrice isEqualTo-1||{_sellPrice isEqualTo-1}) exitWith{};private _houseID=_property getVariable["ga_houseID",-1];private _maxPhys=((_physInv select((count _physInv)-1)) select 0);private _maxVirt=((_virtInv select((count _virtInv)-1)) select 0);private _currentPhys=_property getVariable["ga_phys_cap",_maxPhys];private _currentVirt=_property getVariable["ga_vcap",_maxVirt];private _hasBarrel=_property getVariable["ga_barrel_unaged",false];private _hasGreenhouse=_property getVariable["ga_greenhouse_unaged",false];private _hasLeadContainer=_property getVariable["ga_leadcontainer_unaged",false];private _nextPhysSpace=0;private _nextVirtSpace=0;private _index=0;private _upgradeCost=-1;private _barrelCost=35000;private _greenhouseCost=45000;private _leadContainerCost=250000;private _action=false;_mode=toLower _mode;if(_houseID isEqualTo-1) exitWith{["Could not fetch your house ID.","basic"]spawn life_fnc_handleMessage};switch(_mode) do{case"vstorage":{if(_currentVirt>=_maxVirt) exitWith{["Your property has the max amount of virtual storage upgrades!","basic"]spawn life_fnc_handleMessage;};{if((_x select 0) isEqualTo _currentVirt) then{_index=(_forEachIndex+1);};}forEach _virtInv;_nextVirtSpace=((_virtInv select _index) select 0);_upgradeCost=((_virtInv select _index) select 1);if(_upgradeCost isEqualTo-1) exitWith{};if(_upgradeCost>life_cash&&_upgradeCost>life_atmcash) exitWith{[format["You do not have %1 on-hand or in your bank to upgrade your property.",[_upgradeCost]call life_fnc_numberText],"basic"]spawn life_fnc_handleMessage;};_action=[format["Upgrading your property will increase the virtual item storage to %1 space and will cost you $%2. Do you wish to continue with the purchase?",_nextVirtSpace,[_upgradeCost]call life_fnc_numberText],"Increase storage","Upgrade","Cancel"]call BIS_fnc_guiMessage;if(_action) then{life_houseTxn=true;life_action_in_use=true;if(life_cash>=_upgradeCost) then{life_cash=life_cash-_upgradeCost;life_cashCache=((life_cash/4)+7);}else{life_atmcash=life_atmcash-_upgradeCost;life_atmcashCache=((life_atmcash/4)+5);};[6]call life_fnc_ClupdatePartial;[[_property,player,_mode,_nextVirtSpace,_houseID],"TON_fnc_updateProperty",2]spawn life_fnc_MP;["Upgrading the virtual storage on your property...","basic"]spawn life_fnc_handleMessage;};};case"pstorage":{if(_currentPhys>=_maxPhys) exitWith{["Your property has the max amount of physical storage upgrades!","basic"]spawn life_fnc_handleMessage;};{if((_x select 0) isEqualTo _currentPhys) then{_index=(_forEachIndex+1);};}forEach _physInv;_nextPhysSpace=((_physInv select _index) select 0);_upgradeCost=((_physInv select _index) select 1);