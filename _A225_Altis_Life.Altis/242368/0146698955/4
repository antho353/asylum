params[["_shopType","",[""]]];if(_shopType isEqualTo"") exitWith{};private _asy_display=findDisplay 39500;if(isNull _asy_display) exitWith{};private _topTitle=_asy_display displayCtrl 39501;private _subTitle=_asy_display displayCtrl 39502;private _mainListGroup=_asy_display displayCtrl 39503;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListEdit=_mainListGroup controlsGroupCtrl 1004;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _mainItemListBuyButton=_mainListGroup controlsGroupCtrl 1005;private _mainItemListSellButton=_mainListGroup controlsGroupCtrl 1006;private _shopInfo=[_shopType]call life_fnc_virt_shops;_shopInfo params[["_shopTitle",""],["_buyItems",[]],["_sellItems",[]]];_subTitle ctrlSetText(format["Player Weight: %2/%3",_shopTitle,life_carryWeight,life_maxWeight]);_mainItemList ctrlSetFade 1.00;_mainItemList ctrlCommit 0.00;lbClear _mainItemList;{_x ctrlEnable false}forEach[_mainItemListBuyButton,_mainItemListSellButton];private _ownAndInFortress=([["gang_fortress_marker"],400,player]call life_fnc_inZone)&&(((gang_fortress_flag getVariable["ga_gang_fortress_data",[-1,"Unknown",false,"Unknown",grpNull]]) param[0,-1]) isEqualTo(life_gang_data param[0,-1]));private _isDomination=call life_fnc_isDominationActive;{_x params[["_item",""]];if!(_item isEqualTo"") then{private _name=["getName",_item]call life_fnc_virtItemCfg;private _picture=["getIcon",_item]call life_fnc_virtItemCfg;private _basePrice=["getBasePrice",_item]call life_fnc_virtItemCfg;private _qtyInInventory=missionNameSpace getVariable[format["life_inv_%1",_item],0];private _color=[1,1,1,0.3];private _price=_basePrice*([_shopType,true]call life_fnc_getDiscount);_price=switch(true) do{case((_item isEqualTo"vammo")&&(7 in life_achievements)):{0};case((_item in["canna_dab","marijuanam"])&&(call life_fnc_isDominationActive)):{_price-(_price*0.70)};default{_price};};_price=if(_shopType in["rebel","turf"]) then{_price}else{_price+(_price*(call life_fnc_getGovTax))};_price=if(_ownAndInFortress) then{_price-(_price*0.15)}else{_price};_price=if(call life_fnc_isDominationActive) then{_price-(_price*0.10)}else{_price};private _formatText=format["$%1",[round _price]call life_fnc_numberText];private _invText=format["%1",_qtyInInventory];private _rowIndex=_mainItemList lnbAddRow[_name,_formatText,_invText];_mainItemList lnbSetPicture[[_rowIndex,0],_picture];_mainItemList lnbSetData[[_rowIndex,0],_item];