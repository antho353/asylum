#include"..\..\..\..\..\macro.h"
if(scriptAvailable(5)) exitWith{["You can only attempt to vote for a candidate every couple seconds!","basic"]spawn life_fnc_handleMessage;};private _submitVote={params[["_control",controlNull]];if(isNull _control) exitWith{};if!(ctrlEnabled _control) exitWith{};private _asy_display=findDisplay 351000;private _mainListGroup=_asy_display displayCtrl 351002;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _rightListGroup=_asy_display displayCtrl 351003;private _rightItemList=_rightListGroup controlsGroupCtrl 1000;private _mainItemListSelect=lbCurSel _mainItemList;private _voteButton=_rightListGroup controlsGroupCtrl 1001;if((_control isEqualTo _voteButton)&&(_mainItemListSelect isEqualTo-1)) exitWith{["You need to select a candidate to vote for!","basic"]spawn life_fnc_handleMessage;};(parseSimpleArray(_mainItemList lnbData[_mainItemListSelect,0])) params["_playerUID","_playerName","_policy","_investment","_votes"];private _action=[format["Would you like submit a vote for %1 for Governor of %2?",_playerName,worldName],format["%1 Office",worldName],"Yes","No"]call BIS_fnc_GUIMessage;if(_action) then{[format["Your vote for %1, has been submitted to the Government of %2",_playerName,worldName]]spawn life_fnc_handleMessage;[["addCandidateVote",[player,getPlayerUID player,_playerUID]],"TON_fnc_govSystemSRV",2]call life_fnc_MP;life_govClientData set[2,true];[21]call life_fnc_ClUpdatePartial;closeDialog 0;["action","votegovernor",1]call life_fnc_handleQuest;}else{[format["You have chosen not to vote for %1, select another candidate!",_playerName]]spawn life_fnc_handleMessage;_voteButton ctrlEnable false;};};private _selectCandidate={params[["_controlData",[],[[]]]];if(_controlData isEqualTo[]) exitWith{};private _asy_display=findDisplay 351000;private _mainListGroup=_asy_display displayCtrl 351002;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _rightListGroup=_asy_display displayCtrl 351003;private _rightItemList=_rightListGroup controlsGroupCtrl 1000;private _mainItemListSelect=lbCurSel _mainItemList;private _voteButton=_rightListGroup controlsGroupCtrl 1001;_controlData params["_control","_selectedIndex"];if(_selectedIndex isEqualTo-1) exitWith{};(parseSimpleArray(_control lnbData[_selectedIndex,0])) params["_playerUID","_playerName","_policy","_investment","_votes"];_formatString=format["<t %5 %6>Candidate: %1</t><br/><t %5 %6>Votes: %2</t><br/><t %5 %6>Investment: $%3</t><br/><t %5 %6>Policy: %4</t>",_playerName,_votes,[_investment]call life_fnc_numberText,_policy,"size=1.0","align=left"];_rightItemList ctrlSetStructuredText parseText _formatString;if(life_govClientData param[2,false]) exitWith{_voteButton ctrlEnable false;};_voteButton ctrlEnable true;