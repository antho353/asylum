disableSerialization;params[["_house",objNull,[objNull]]];if(isNull _house) exitWith{closeDialog 0};if!(SRV_HousesSetup) exitWith{["Please wait a bit while houses are being initalized...","basic"]spawn life_fnc_handleMessage;closeDialog 0};if(life_action_in_use) exitWith{closeDialog 0;};if!(alive _house) exitWith{closeDialog 0;};if!((typeOf _house) in life_houseTypes) exitWith{closeDialog 0};if!(playerSide isEqualTo civilian) exitWith{closeDialog 0};private _isOwner=(getPlayerUID player) isEqualTo(_house getVariable["ga_homeOwner",""]);private _hasKeys=([cursorObject,getPlayerUID player,"accessHouse"]call life_fnc_keyHolderStatus);if(!_isOwner&&!_hasKeys) exitWith{closeDialog 0;if!(license_civ_home) exitWith{["You don't have a home owners license.","basic"]spawn life_fnc_handleMessage;};if!(playerSide isEqualTo civilian) exitWith{};if(_house getVariable["ga_restricted_house",false]) exitWith{["This house cannot be purchased.","basic"]spawn life_fnc_handleMessage;};[_house]spawn life_fnc_buyHouse;};["houseMenu"]call life_fnc_createDialog;private _display=findDisplay 2100;private _title=_display displayCtrl 2101;private _houseInfo=_display displayCtrl 2102;private _closeButton=_display displayCtrl 2103;private _lightsColor=_display displayCtrl 2104;private _lightsButton=_display displayCtrl 2105;private _viewStorage=_display displayCtrl 2106;private _storageLock=_display displayCtrl 2107;private _upgradeVirtual=_display displayCtrl 2108;private _upgradePhysical=_display displayCtrl 2109;private _manageKeys=_display displayCtrl 2110;private _viewKeyholders=_display displayCtrl 2111;private _sellMarket=_display displayCtrl 2112;private _listSale=_display displayCtrl 2113;private _agingBarrel=_display displayCtrl 2114;private _temp1=_display displayCtrl 2115;private _temp2=_display displayCtrl 2116;private _temp3=_display displayCtrl 2117;private _temp4=_display displayCtrl 2118;private _temp5=_display displayCtrl 2119;life_pInact_curTarget=_house;private _houseID=_house getVariable["ga_houseID",-1];private _virtualCap=_house getVariable["ga_vcap",100];private _physicalCap=_house getVariable["ga_phys_cap",100];private _keyCapCount=_house getVariable["ga_keycap",0];private _mainButtons=[_lightsButton,_viewStorage,_storageLock,_upgradeVirtual,_upgradePhysical,_manageKeys,_viewKeyholders,_sellMarket,_listSale,_agingBarrel,_temp1,_temp2,_temp3,_temp4,_temp5];(_house getVariable["ga_house_electric",[false,0]]) params[["_electricNeedToPay",false,[false]],["_electricPriceToPay",0,[0]]];{if(ctrlText _x isEqualTo"") then{_x ctrlShow false};if!(_isOwner) then{_x ctrlEnable false};}forEach _mainButtons;([typeOf _house]call life_fnc_houseConfig) params["_houseCost","_sellPrice","_physicalCaps","_virtualCaps"];private _maxedPhysicalUpgrades=_physicalCap isEqualTo((_physicalCaps select(count _physicalCaps-1)) select 0);private _maxedVirtualUpgrades=_virtualCap isEqualTo((_virtualCaps select(count _virtualCaps-1)) select 0);private _canAccessInventory=(_house isKindOf"House_F"&&(player distance _house<10))&&{_house in life_vehicles||(playerside isEqualTo civilian&&(getPlayerUID player in(_house getVariable["ga_house_keys",[]])))};private _canAccessInventoryAsAdmin=(_house isKindOf"House_F"&&(player distance _house<10))&&{(call life_adminLevel>=2)&&(playerSide isEqualTo civilian)&&!(_house in life_vehicles)&&!(getPlayerUID player in(_house getVariable["ga_house_keys",[]]))&&(_houseID>0)};private _isGarage=(typeOf _house) in["Land_i_Garage_V1_F","Land_i_Garage_V2_F","Land_i_Garage_V1_dam_F","Land_i_Garage_V2_dam_F"];{_x params["_button","_condition","_trueText","_falseText","_action",["_enable",true,[true]]];if(isNull _button) then{_button=_mainButtons param[_mainButtons findIf{!ctrlShown _x},controlNull]};if(call _condition) then{_button ctrlEnable _enable};if(call _condition&&!(ctrlShown _button)) then{_button ctrlShow true};private _text=if(call _condition) then{_trueText}else{[_falseText,ctrlText _button]select(_falseText isEqualTo"")};_button ctrlSetText _text;_button buttonSetAction _action;}forEach[[_storageLock,{_house getVariable["ga_locked",false]},"Unlock Storage","Lock Storage","[life_pInact_curTarget] call life_fnc_lockHouse; closeDialog 0;"],[_upgradePhysical,{_maxedPhysicalUpgrades},"Fully Upgraded","","[life_pInact_curTarget, 'pstorage'] spawn life_fnc_upgradeProperty; closeDialog 0;",false],[_upgradeVirtual,{_maxedVirtualUpgrades},"Fully Upgraded","","[life_pInact_curTarget, 'vstorage'] spawn life_fnc_upgradeProperty; closeDialog 0;",false],[_viewKeyholders,{true},"View Key Holders","","[] call life_fnc_listKeyHolders;"],[_manageKeys,{true},"Manage Keys","","['propertyKeys'] call life_fnc_createDialog;"],[_viewStorage,{_canAccessInventory||_canAccessInventoryAsAdmin},"View Storage","",["closeDialog 0; [life_pInact_curTarget, false] spawn life_fnc_openInventory;","closeDialog 0; [life_pInact_curTarget, true] spawn life_fnc_openInventory;"]select _canAccessInventoryAsAdmin],[_listSale,{_house getVariable["ga_house_price",-1]isEqualTo-1},"List for Sale","Remove Listing","closeDialog 0; [life_pInact_curTarget] spawn life_fnc_marketSellHouse;"],[_sellMarket,{true},"Sell to Bank","","closeDialog 0; [life_pInact_curTarget] spawn life_fnc_sellHouse;"],[_lightsButton,{isNull(_house getVariable["ga_lightSource",objNull])},"Turn Lights On","Turn Lights Off",""],[controlNull,{_house getVariable["ga_barrel_unaged",false]&&!(_isGarage)},"Barrel Installed","Add Aging Barrel","[life_pInact_curTarget,'aging'] spawn life_fnc_upgradeProperty; closeDialog 0;",false],[controlNull,{!(_house getVariable["ga_barrel_unaged",false])&&!(_isGarage)},"Add Aging Barrel","Fully Upgraded","[life_pInact_curTarget,'aging'] spawn life_fnc_upgradeProperty; closeDialog 0;"],[controlNull,{_house getVariable["ga_greenhouse_unaged",false]&&!(_isGarage)},"Greehouse Installed","Add Greenhouse","[life_pInact_curTarget,'greenhouse'] spawn life_fnc_upgradeProperty; closeDialog 0;",false],[controlNull,{!(_house getVariable["ga_greenhouse_unaged",false])&&!(_isGarage)},"Add Greenhouse","Fully Upgraded","[life_pInact_curTarget,'greenhouse'] spawn life_fnc_upgradeProperty; closeDialog 0;"],[controlNull,{_house getVariable["ga_leadcontainer_unaged",false]&&!(_isGarage)},"Lead Container Installed","Add Lead Container","[life_pInact_curTarget,'leadcontainer'] spawn life_fnc_upgradeProperty; closeDialog 0;",false],[controlNull,{!(_house getVariable["ga_leadcontainer_unaged",false])&&!(_isGarage)},"Add Lead Container","Lead Container Installed","[life_pInact_curTarget,'leadcontainer'] spawn life_fnc_upgradeProperty; closeDialog 0;"],[controlNull,{(life_gang_data param[2,0]isEqualTo 1)&&(life_gang_data param[3,[0,0,0]]isEqualTo[0,0,0])},"Set Gang House","","closeDialog 0; [life_pInact_curTarget] spawn life_fnc_setGangHouse;"],[controlNull,{_isGarage},"Access Garage","","['Car', life_pInact_curTarget] call life_fnc_handleVehicles;"],[controlNull,{_isGarage},"Store Vehicle","","closeDialog 0; [life_pInact_curTarget, player] spawn life_fnc_storeVehicle;"],[controlNull,{(life_gang_data param[2,0]isEqualTo 1)&&(_house getVariable["ga_house_gang",-1]isEqualTo(life_gang_data param[0,-5]))},"Remove Gang House","",format["closeDialog 0; [] spawn{ if (['Are you sure you no longer want this house as your gang house?', 'Remove Gang House', 'Yes', 'No'] call BIS_fnc_guiMessage) then {[[life_pInact_curTarget, %1], 'life_fnc_removeGangHouse', [%1] call life_fnc_getOnlineMembers] spawn life_fnc_MP; [[life_pInact_curTarget, %1], 'TON_fnc_removeGangHouseSRV', 2] spawn life_fnc_MP}; };",life_gang_data param[0,-1]]],[controlNull,{(life_gang_data param[2,0]isEqualTo 1)&&_house getVariable["ga_house_gang",-1]!=(life_gangBuilding param[0,objNull]getVariable["ga_house_gang",-2])&&!(isNull(life_gangBuilding select 0))},"Change Gang House","",format["closeDialog 0; [] spawn{ if (['Are you sure you want to change your gang house to this house?', 'Change Gang House', 'Yes', 'No'] call BIS_fnc_guiMessage) then {[[life_gangBuilding param [0, objNull], life_pInact_curTarget], 'life_fnc_changeGangHouse', [%1] call life_fnc_getOnlineMembers] spawn life_fnc_MP}; };",life_gang_data param[0,-1]]],[controlNull,{_electricNeedToPay},"Pay Electric Bill","Electric Bill Payed","[life_pInact_curTarget] spawn life_fnc_houseElectricBill; closeDialog 0;"]];