private _acceptedRequest={params[["_control",controlNull,[controlNull]],["_notMenu",false,[false]],["_notMenuIDX",-1,[0]]];if(_notMenu) exitWith{if(_notMenuIDX isEqualTo-1) exitWith{["Error, try another person to respond to!","basic"]spawn life_fnc_handleMessage;};(life_medicRequestedCorpses param[_notMenuIDX,[objNull,"","",0]]) params[["_xCaller",objNull,[objNull]],["_xCorpse",objNull,[objNull]],["_xCorpseUID","",[""]],["_xCorpseName","",[""]],["_xRequestedTime",0,[0]]];private _debugPlayer=allPlayers param[allPlayers findIf{((getPlayerUID _x) isEqualTo _xCorpseUID)&&(_x distance2D(getMarkerPos"respawn_west")<=1000)},objNull];if((time<(life_medicLastRequestSent param[1,-25]))&&((life_medicLastRequestSent param[0,""]) isEqualTo _xCorpseUID)) exitWith{[format["You have already sent a request to %1 in the past 25 seconds.",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};[format["Sending acceptance request to AFD dispatch for %1...",_xCorpseName],"basic"]spawn life_fnc_handleMessage;if!(((_xCorpse getVariable["ga_requestAccepetor",[objNull,""]]) param[0,objNull]) in[player,objNull]) exitWith{[format["Another medic is already responding to %1, try someone else!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};[[player,profileName,(life_medicLastRequest param[0,objNull]),(life_medicLastRequest param[1,objNull])],"life_fnc_sendMedicRequest",(life_medicLastRequest param[0,objNull]),false,false]spawn life_fnc_MP;life_medicLastRequestSent=+[_xCorpseUID,time+25];private _maxWaitTime=time+15;waitUntil{time>_maxWaitTime||(((_xCorpse getVariable["ga_requestAccepetor",[objNull,""]]) param[0,objNull]) isEqualTo player)};if(time>_maxWaitTime) exitWith{[format["%1 has ignored your request for medical attention!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};if!(((_xCorpse getVariable["ga_requestAccepetor",[objNull,""]]) param[0,objNull]) in[player,objNull]) exitWith{[format["Another medic is already responding to %1, try someone else!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};if(isNull(life_medicAcceptedCorpse param[1,objNull])) then{life_medicAcceptedCorpse=+[_xCaller,_xCorpse,_xCorpseUID,_xCorpseName,getPosATL player,time];_xCorpse setVariable["ga_requestAccepetor",[player,profileName],true];[format["%1 has been informed that you are en-route. Make haste!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;closeDialog 0;[_xCorpse,_xCorpseName]spawn{params[["_xCorpse",objNull,[objNull]],["_xCorpseName","",[""]]];private _handlerID=addMissionEventHandler["Draw3D",{_thisArgs params["_xCorpse","_xCorpseName"];drawIcon3D["\A3\ui_f\data\map\mapcontrol\Hospital_CA.paa",[[1,0,0,1],[1,0,0,1]],getPosATL _xCorpse,1,1,0,format["%1 (%2m) - Unconscious",_xCorpseName,[round(player distance2D _xCorpse)]call life_fnc_numberText],1,0.03,"RobotoCondensed","center",true];},[_xCorpse,_xCorpseName]];waitUntil{uiSleep 1;isNull _xCorpse};removeMissionEventHandler["Draw3D",_handlerID];};}else{[format["You already have a medic request active for %1",(life_medicAcceptedCorpse param[3,"Error Name"])],"basic"]spawn life_fnc_handleMessage;};};if(isNull _control) exitWith{};if!(ctrlEnabled _control) exitWith{};private _asy_display=findDisplay 352000;private _mainListGroup=_asy_display displayCtrl 352002;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _rightListGroup=_asy_display displayCtrl 352003;private _rightItemList=_rightListGroup controlsGroupCtrl 1000;private _acceptButton=_rightListGroup controlsGroupCtrl 1001;private _mainItemListSelect=lbCurSel _mainItemList;if((_control isEqualTo _acceptButton)&&(_mainItemListSelect isEqualTo-1)) exitWith{["You need to select a patient to accept a request from!","basic"]spawn life_fnc_handleMessage;};private _arrayIDX=(parseNumber(_mainItemList lnbData[_mainItemListSelect,0]));(life_medicRequestedCorpses param[_arrayIDX,[objNull,"","",0]]) params[["_xCaller",objNull,[objNull]],["_xCorpse",objNull,[objNull]],["_xCorpseUID","",[""]],["_xCorpseName","",[""]],["_xRequestedTime",0,[0]]];private _debugPlayer=allPlayers param[allPlayers findIf{((getPlayerUID _x) isEqualTo _xCorpseUID)&&(_x distance2D(getMarkerPos"respawn_west")<=1000)},objNull];if((time<(life_medicLastRequestSent param[1,-25]))&&((life_medicLastRequestSent param[0,""]) isEqualTo _xCorpseUID)) exitWith{[format["You have already sent a request to %1 in the past 25 seconds.",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};private _action=[format["Do you want to accept the medical request from %1?",_xCorpseName],"AFD Accept Request","Yes","No"]call BIS_fnc_GUIMessage;[format["Sending acceptance request to AFD dispatch for %1...",_xCorpseName],"basic"]spawn life_fnc_handleMessage;_acceptButton ctrlEnable false;closeDialog 0;if!(((_xCorpse getVariable["ga_requestAccepetor",[objNull,""]]) param[0,objNull]) in[player,objNull]) exitWith{[format["Another medic is already responding to %1, try someone else!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};[[player,profileName,(life_medicLastRequest param[0,objNull]),(life_medicLastRequest param[1,objNull])],"life_fnc_sendMedicRequest",(life_medicLastRequest param[0,objNull]),false,false]spawn life_fnc_MP;life_medicLastRequestSent=+[_xCorpseUID,time+25];private _maxWaitTime=time+15;waitUntil{time>_maxWaitTime||(((_xCorpse getVariable["ga_requestAccepetor",[objNull,""]]) param[0,objNull]) isEqualTo player)};if(time>_maxWaitTime) exitWith{[format["%1 has ignored your request for medical attention!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};if!(((_xCorpse getVariable["ga_requestAccepetor",[objNull,""]]) param[0,objNull]) in[player,objNull]) exitWith{[format["Another medic is already responding to %1, try someone else!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;};if(isNull(life_medicAcceptedCorpse param[1,objNull])) then{life_medicAcceptedCorpse=+[_xCaller,_xCorpse,_xCorpseUID,_xCorpseName,getPosATL player,time];_xCorpse setVariable["ga_requestAccepetor",[player,profileName],true];[format["%1 has been informed that you are en-route. Make haste!",_xCorpseName],"basic"]spawn life_fnc_handleMessage;[_xCorpse,_xCorpseName]spawn{params[["_xCorpse",objNull,[objNull]],["_xCorpseName","",[""]]];private _handlerID=addMissionEventHandler["Draw3D",{_thisArgs params["_xCorpse","_xCorpseName"];drawIcon3D["\A3\ui_f\data\map\mapcontrol\Hospital_CA.paa",[[1,0,0,1],[1,0,0,1]],getPosATL _xCorpse,1,1,0,format["%1 (%2m) - Unconscious",_xCorpseName,[round(player distance2D _xCorpse)]call life_fnc_numberText],1,0.03,"RobotoCondensed","center",true];},[_xCorpse,_xCorpseName]];waitUntil{uiSleep 1;isNull _xCorpse};removeMissionEventHandler["Draw3D",_handlerID];};}else{[format["You already have a medic request active for %1",(life_medicAcceptedCorpse param[3,"Error Name"])],"basic"]spawn life_fnc_handleMessage;};};private _selectPatient={params[["_controlData",[],[[]]]];if(_controlData isEqualTo[]) exitWith{};private _asy_display=findDisplay 352000;private _mainListGroup=_asy_display displayCtrl 352002;private _mainItemList=_mainListGroup controlsGroupCtrl 1000;private _mainItemListBackground=_mainListGroup controlsGroupCtrl 1003;private _rightListGroup=_asy_display displayCtrl 352003;private _rightItemList=_rightListGroup controlsGroupCtrl 1000;private _acceptButton=_rightListGroup controlsGroupCtrl 1001;private _mainItemListSelect=lbCurSel _mainItemList;