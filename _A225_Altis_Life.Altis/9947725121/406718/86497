#include"..\..\macro.h"
disableSerialization;if((lbCurSel 4503) isEqualTo-1) exitWith{["You did not select anything.","basic"]spawn life_fnc_handleMessage;};private _playerItemSelected=getSelData(4503);private _quantity=ctrlText 4506;if(_playerItemSelected isEqualTo"") exitWith{["You did not select anything.","basic"]spawn life_fnc_handleMessage;};if!([_quantity]call life_fnc_isNumber) exitWith{["Invalid Number format","basic"]spawn life_fnc_handleMessage;};private _itemWeight=getNumber(missionConfigFile>>"CfgWeights">>_playerItemSelected>>"weight");_quantity=parseNumber _quantity;if(_quantity isEqualTo 0) exitWith{["You need to enter an amount to store!","basic"]spawn life_fnc_handleMessage;};if(_quantity<1) exitWith{["You can't enter anything below one!","basic"]spawn life_fnc_handleMessage;};if(!life_is_virtual&&_itemWeight isEqualTo 0) exitWith{["This item cannot be stored.","basic"]spawn life_fnc_handleMessage};if((_playerItemSelected in["goldbar"])&&life_trunk_vehicle isKindOf"Air") exitWith{["This is too heavy for safe air transport!","basic"]spawn life_fnc_handleMessage;};if((_playerItemSelected in["uraniumu","uraniump"])&&!(life_trunk_vehicle isKindOf"House_F")&&!((typeOf life_trunk_vehicle) in["B_Truck_01_box_F","C_Van_01_box_F"])) exitWith{["This needs a HEMTT Box or Box Truck to safely transport!","basic"]spawn life_fnc_handleMessage;};if(_playerItemSelected in["uraniumu"]&&life_trunk_vehicle isKindOf"House_F") exitWith{["The unrefined uranium is too radioactive for your house!"]spawn life_fnc_handleMessage;};if((_playerItemSelected in["goldbar","bank_money"])&&life_trunk_vehicle isKindOf"House_F") exitWith{["You can't fit this in your house!","basic"]spawn life_fnc_handleMessage;};if((_playerItemSelected in["crankp","crank"])&&life_trunk_vehicle isKindOf"House_F") exitWith{["This item is too dangerous to store in your home!","basic"]spawn life_fnc_handleMessage;};if(life_trunk_vehicle getVariable["ga_questloot",false]) exitWith{["This crate is only intended for you to take your items!","basic"]spawn life_fnc_handleMessage;};if((_playerItemSelected in["jewelHope","jewelRolex","jewelAP","jewelDiamonds","jewelGoldBag","jewelExoJewels","jewelRing","jewelBling","jewelBag"])&&life_trunk_vehicle isKindOf"House_F") exitWith{["The African Warlord's henchmen will not allow you to store this!!"]spawn life_fnc_handleMessage;};if((_playerItemSelected in["jewelHope","jewelRolex","jewelAP","jewelDiamonds","jewelGoldBag","jewelExoJewels","jewelRing","jewelBling","jewelBag"])&&life_trunk_vehicle isKindOf"Air") exitWith{["This is too heavy for safe air transport!","basic"]spawn life_fnc_handleMessage;};private _vehPos=getPos life_trunk_vehicle;private _playerPos=getPos player;if(_vehPos distance _playerPos>10) exitWith{closeDialog 0;["You are too far away!","basic"]spawn life_fnc_handleMessage;};private _itemWeight=0;private _data=[[],0];life_inventoryInteraction=true;if(life_is_virtual) then{_itemWeight=(["getItemWeight",_playerItemSelected]call life_fnc_virtItemCfg)*_quantity;_data=life_trunk_vehicle getVariable["ga_vinv",[[],0]];private _inv=_data select 0;private _currentWeight=_data select 1;private _totalWeight=(life_trunk_vehicle getVariable["ga_vcap",100]);if(((_currentWeight+_itemWeight)>_totalWeight)) exitWith{["The vehicle is either full or cannot hold that much.","basic"]spawn life_fnc_handleMessage;};private _uExit=false;if(_playerItemSelected isEqualTo"uraniump"&&{life_trunk_vehicle isKindOf"House_F"}) then{private _index=["uraniump",_inv]call life_fnc_index;if!(_index isEqualTo-1) then{private _uraniumCount=(_inv select _index) select 1;if((_uraniumCount+_quantity>50)&&!(life_trunk_vehicle getVariable["ga_leadcontainer_unaged",false])) then{_uExit=true;};};};if(_uExit) exitWith{if!(life_trunk_vehicle getVariable["ga_leadcontainer_unaged",false]) then{["Your home is either full or cannot hold that much uranium. Consider buying a lead container to hold more than 50 uranium!","basic"]spawn life_fnc_handleMessage;}else{["Your home is either full or cannot hold that much uranium.","basic"]spawn life_fnc_handleMessage;};};if(!([false,_playerItemSelected,_quantity]call life_fnc_handleInv)&&!(life_adminForce)) exitWith{["Couldn't remove the items from your inventory to put in the vehicle.","basic"]spawn life_fnc_handleMessage;};private _index=[_playerItemSelected,_inv]call life_fnc_index;if(_index isEqualTo-1) then{_inv pushBack[_playerItemSelected,_quantity];}else{private _val=_inv select _index select 1;_inv set[_index,[_playerItemSelected,_val+_quantity]];};life_trunk_vehicle setVariable["ga_vinv",[_inv,(_currentWeight)+_itemWeight],true];if!(life_adminForce) then{[life_trunk_vehicle,life_is_virtual]call life_fnc_refreshInventory;}else{[life_trunk_vehicle,true]call life_fnc_refreshAdminInventory;};[true]call life_fnc_saveGear;}else{_itemWeight=getNumber(missionConfigFile>>"CfgWeights">>(_playerItemSelected)>>"weight");_data=life_trunk_vehicle getVariable["ga_pinv",[[],0]];private _inv=_data select 0;private _totalWeight=(life_trunk_vehicle getVariable["ga_phys_cap",100]);private _currentWeight=_data select 1;private _combinedWeight=_itemWeight;private _tempItem="";private _index=-1;private _maxValue=lbValue[4503,(lbCurSel 4503)];if(_quantity>_maxValue) then{_quantity=_maxValue};private _fnc_adjustArray={params["_item","_array"];if!(_item isEqualTo"") then{private _index=-1;{if!(_index isEqualTo-1) exitWith{};if(_item isEqualTo(_x select 0)) exitWith{_index=_forEachIndex;};}forEach _array;if(_index isEqualTo-1) then{_array pushBack[_item,1];}else{_array set[_index,[_item,((_array select _index) select 1)+1]];};};_array;};if!(life_adminForce) then{for"_i"from 1 to _quantity do{switch(true) do{case(_playerItemSelected isEqualTo(primaryWeapon player)&&!(_playerItemSelected in(items player))):{{if!(_x isEqualTo"") then{_combinedWeight=_combinedWeight+getNumber(missionConfigFile>>"CfgWeights">>(_x)>>"weight");};}forEach(primaryWeaponItems player);{if!(_x isEqualTo"") then{_combinedWeight=_combinedWeight+getNumber(missionConfigFile>>"CfgWeights">>(_x)>>"weight");};}forEach(primaryWeaponMagazine player);