if(primaryWeapon _unit==""&&_storedWeapon!="") then{_unit addWeapon _storedWeapon;_unit selectWeapon _storedWeapon;};};};if(true) exitWith{};private _linked=_unit nearObjects["MAN",5];private _linked=_linked-[_unit];{_xSet=_x getVariable["ASY_fnc_ambientAnim__animset",""];if(_xSet!=_animset||_xSet=="") then{_linked set[_forEachIndex,objNull];}else{_xLinked=_x getVariable["ASY_fnc_ambientAnim__linked",[]];if!(_unit in _xLinked) then{_xLinked=_xLinked+[_unit];_x setVariable["ASY_fnc_ambientAnim__linked",_xLinked];};};}forEach _linked;private _linked=_linked-[objNull];private _attachSpecsAuto=switch(_animset) do{case"SIT_AT_TABLE":{[["Land_CampingChair_V2_F",[0,0.08,-0.02],-180],["Land_ChairPlastic_F",[0,0.08,-0.02],90],["Land_ChairWood_F",[0,0.02,-0.02],-180]];};case"SIT";case"SIT1";case"SIT2";case"SIT3";case"SIT_U1";case"SIT_U2";case"SIT_U3":{[["Land_CampingChair_V2_F",[0,0.08,0.05],-180],["Land_ChairPlastic_F",[0,0.08,0.05],90],["Land_ChairWood_F",[0,0.02,0.05],-180]];};case"SIT_SAD1":{[["Box_NATO_Wps_F",[0,-0.27,0.03],0]];};case"SIT_SAD2":{[["Box_NATO_Wps_F",[0,-0.3,0.05],0]];};case"SIT_HIGH1":{[["Box_NATO_Wps_F",[0,-0.23,0.03],0]];};case"SIT_HIGH";case"SIT_HIGH2":{[["Box_NATO_Wps_F",[0,-0.12,-0.20],0]];};default{[];};};if((count _attachSpecsAuto>0)&&!(_gear in["NONE","LIGHT"])) then{private _attachGearFix=0.06;private _vest=toLower(vest _unit);if(_vest in["v_platecarrier1_rgr"]) theN{_attachGearFix=_attachGearFix+0.08;};{_attachPoint=_x select 1;_attachPoint set[1,(_attachPoint select 1)+_attachGearFix];_x set[1,_attachPoint];}forEach _attachSpecsAuto;};_attachSpecsAuto=_attachSpecsAuto+[["Sign_Pointer_Cyan_F",[0,0,_attachOffset],0]];if!(isNull _forcedSnapPoint) then{_attachObj=_forcedSnapPoint;_attachSpecs=[typeOf _forcedSnapPoint,[0,0,_attachOffset],0];{if((_x select 0)==typeOf _forcedSnapPoint) exitWith {_attachSpecs=_x;};}forEach _attachSpecsAuto;}else{_attachSpecs=[typeOf _unit,[0,0,_attachOffset],0];_attachObj=_unit;{private _obj=nearestObject[_unit,_x select 0];if(([_obj,_unit]call BIS_fnc_distance2D)<_attachSnap) exitWith {_attachSpecs=_x;_attachObj=_obj;};}forEach _attachSpecsAuto;};_unit setVariable["ASY_fnc_ambientAnim__linked",_linked];_unit setVariable["ASY_fnc_ambientAnim__anims",_anims];_unit setVariable["ASY_fnc_ambientAnim__animset",_animset];_unit setVariable["ASY_fnc_ambientAnim__interpolate",_interpolate&&_canInterpolate];_unit setVariable["ASY_fnc_ambientAnim__time",0];_attachObj disableCollisionWith _unit;_unit disableCollisionWith _attachObj;[_unit,_attachObj,_attachSpecs,_azimutFix,_attach]spawn{_unit =_this select 0;_attachObj=_this select 1;_attachSpecs=_this select 2;_azimutFix=(_this select 3)+(_attachSpecs select 2);_attach =_this select 4;waitUntil{time>0};if(isNil"_unit") exitWith{};if(isNull _unit) exitWith{};if!(alive _unit&&canMove _unit) exitWith{};_attachPos=getPosASL _attachObj;_logic="Logic"createVehicleLocal[_attachPos select 0,_attachPos select 1,_attachPos select 2];waitUntil{!isNull _logic};_logic enableSimulation true;_logic allowDamage false;_logic setPosASL _attachPos;_logic setDir((getDir _attachObj)+_azimutFix);_unit setVariable["ASY_fnc_ambientAnim__logic",_logic];_unit setVariable["ASY_fnc_ambientAnim__logic",_logic];_unit setVariable["ASY_fnc_ambientAnim__helper",_attachObj];if(_attach) then{_unit attachTo[_logic,_attachSpecs select 1];_unit setVariable["ASY_fnc_ambientAnim__attached",true];};_unit call NPC_fnc_ambientAnimPlay;_ehAnimDone=_unit addEventHandler["AnimDone",{params["_unit","_anim"];private _pool=_unit getVariable["ASY_fnc_ambientAnim__anims",[]];if(alive _unit) then{_unit call NPC_fnc_ambientAnimPlay;};}];_unit setVariable["BIS_EhAnimDone",_ehAnimDone];};