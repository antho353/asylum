#include"..\..\..\..\..\..\..\macro.h"
if(scriptAvailable(0.275)) exitWith{};disableSerialization;params[["_shopType","",[""]],["_control",controlNull,[controlNull]]];if((lbCurSel 2401) isEqualTo-1) exitWith{["You need to select an item to buy.","basic"]spawn life_fnc_handleMessage;};private _item=lbData[2401,lbCurSel 2401];private _price=lbValue[2401,lbCurSel 2401];private _amount=parseNumber(ctrlText 2404);if(_amount>100) exitWith{["You cannot buy more than 100 at a time.","basic"]spawn life_fnc_handleMessage;};if(_amount<=0) exitWith{["You need to buy at least one","basic"]spawn life_fnc_handleMessage;};private _diff=[_item,_amount,life_carryWeight,life_maxWeight]call life_fnc_calWeightDiff;if(_diff<=0) exitWith{["You don't have enough space for that amount!","basic"]spawn life_fnc_handleMessage;};private _amount=_diff;private _itemName=["getName",_item]call life_fnc_virtItemCfg;private _exit=false;_price=round(_price*_amount);if([true,_item,_amount]call life_fnc_handleInv) then{private _pointData=drug_flag getVariable["ga_capData",[0,"Neutral",0.5]];_pointData params["_flagGangID","_flagGangName","_progress"];private _extra="";if((_shopType=="rebel")&&!(life_armsCartel select 0)&&((call life_adminLevel)<3)) then{private _cut=floor((_price)*0.08);private _updateVal=(life_armsCartel select 1);_updateVal=_updateVal+_cut;life_armsCartel set[1,_updateVal];_extra=format[", with $%1 going to the owner of the Arms Dealer",[_cut]call life_fnc_numberText];};_control ctrlEnable false;if!(_shopType=="rebel") then{if!([_price]call life_fnc_debitCard) exitWith{_exit=true;};}else{if(life_cash<_price) exitWith{[format["You do not have enough cash on you to purchase this. Requires $%1.",[_price]call life_fnc_numberText],"basic"]spawn life_fnc_handleMessage;