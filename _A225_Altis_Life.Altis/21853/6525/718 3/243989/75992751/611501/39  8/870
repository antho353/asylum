life_action_in_use=false;5 cutText["","PLAIN"];if!(_isSuccess) exitWith{["You have failed to prime the thermite laptop","basic"]spawn life_fnc_handleMessage;};["The Thermite Explosive is being primed..."]spawn life_fnc_handleMessage;uiSleep(random 2);uiSleep(random 3);uiSleep(random 3);[false,"thermite",1]call life_fnc_handleInv;if(_laptopObject getVariable["ga_mentalThermiteStarted",false]) exitWith{[true,"thermite",1]call life_fnc_handleInv;["This thermite has already been set! Wait the entire 15 minutes and holdout!","basic"]spawn life_fnc_handleMessage;};[[format["The thermite has ignited. Hold out for 15 minutes until the thermite explodes!"],"warning"],"life_fnc_handleMessage",group player]spawn life_fnc_MP;life_mentalLaptopFrontDoor setVariable["ga_mentalThermiteStarted",true,true];};case("uploadLaptopVirusHack"):{_mentalData params[["_laptopObject",objNull,[objNull]],["_laptopNumber",-1,[0]]];private _countNotHacked={private _mentalLaptops=[life_mentalLaptop1,life_mentalLaptop2,life_mentalLaptop3,life_mentalLaptop4,life_mentalLaptop5];private _count=0;{if!(_x getVariable["ga_mentalLaptopHacked",false]) then{_count=_count+1;};}forEach _mentalLaptops;_count};private _mentalLaptops=[life_mentalLaptop1,life_mentalLaptop2,life_mentalLaptop3,life_mentalLaptop4,life_mentalLaptop5];private _laptopNumber=[1,2,3,4,5]param[_mentalLaptops find _laptopObject,-1];if!(playerSide isEqualTo civilian) exitWith{};if(_laptopObject getVariable["ga_mentalLaptopHacked",false]) exitWith{["This laptop has already been hacked!","basic"]spawn life_fnc_handleMessage};if(missionNamespace getVariable["ga_mentalCurrentlyHacking",false]) exitWith{["You are currently already hacking a laptop","basic"]spawn life_fnc_handleMessage};if(life_inv_usb<=0) exitWith{["You need a usb to inject the virus!","basic"]spawn life_fnc_handleMessage;};if!(typeOf _laptopObject isEqualTo"Land_Laptop_unfolded_F") exitWith{};if!(SRV_mentalAsylumData param[1,false]) exitWith{["You must breach the front or back entrance first!","basic"]spawn life_fnc_handleMessage;};if!(_laptopObject in _mentalLaptops) exitWith{};if!(life_mentalLaptopFrontDoor getVariable["ga_mentalThermiteEnded",false]) exitWith{["Wait for the thermite to explode first!","basic"]spawn life_fnc_handleMessage;};private _hackMentalLaptop={params[["_laptopObject",objNull,[objNull]],["_laptopNumber",-1,[0]],"_countNotHacked"];missionNamespace setVariable["ga_mentalCurrentlyHacking",true];disableSerialization;5 cutRsc["life_progress","PLAIN"];private _display=uiNameSpace getVariable["life_progress",displayNull];private _progressBar=_display displayCtrl 38201;private _progressText=_display displayCtrl 38202;life_action_in_use=true;private _increment=1;private _totalTime=45;private _currentPoint=0;private _loopDelay=_totalTime/floor(100/_increment);private _text=format["Uploading Trojan Virus to Laptop Station %1",_laptopNumber];private _startCount=0;_progressBar progressSetPosition _startCount;_progressText ctrlSetText format["%1 (%2%3)",_text,_startCount,"%"];[["Acts_TerminalOpen",_totalTime,"switchMove",player],"life_fnc_handleAnim",(allPlayers select{(_x distance player)<=100})]spawn life_fnc_MP;private _isSuccess=for"_i"from 0 to 1 step 0 do{uiSleep _loopDelay;if(isNull _progressBar) exitWith{["You have failed to upload the virus to the laptop","basic"]spawn life_fnc_handleMessage;false};_currentPoint=(progressPosition _progressBar)+(_increment/100);_progressBar progressSetPosition _currentPoint;_progressText ctrlSetText format["%1 (%2%3)",_text,round(_currentPoint*100),"%"];if(_currentPoint>=1) exitWith{true};if((speed player)>=3) exitWith{["You have failed to upload the virus.","basic"]spawn life_fnc_handleMessage;missionNamespace setVariable["ga_mentalCurrentlyHacking",false];false};if!(isNull objectParent player) exitWith{["You have failed to upload the virus.","basic"]spawn life_fnc_handleMessage;missionNamespace setVariable["ga_mentalCurrentlyHacking",false];false};if(!life_action_in_use||!alive player) exitWith{["You have failed to upload the virus.","basic"]spawn life_fnc_handleMessage;missionNamespace setVariable["ga_mentalCurrentlyHacking",false];false};false;};["",0,"switchMove",player]spawn life_fnc_handleAnim;life_action_in_use=false;5 cutText["","PLAIN"];if!(_isSuccess) exitWith{["You have failed to upload the virus.","basic"]spawn life_fnc_handleMessage;missionNamespace setVariable["ga_mentalCurrentlyHacking",false];};missionNamespace setVariable["ga_mentalCurrentlyHacking",false];_laptopObject setVariable["ga_mentalLaptopHacked",true,true];[format["You have hacked laptop station %1! %2 to go!",_laptopNumber,([]call _countNotHacked)],"basic"]spawn life_fnc_handleMessage;};[_laptopObject,_laptopNumber,_countNotHacked]spawn _hackMentalLaptop;};case("enterKeyCode"):{private _asy_display=findDisplay 782000;if(isNull _asy_display) exitWith{};private _churchObj=nearestObject[(getMarkerPos"life_mentalHospitalPatient"),"Land_Church_05_F"];private _enteredKey=ctrlText 782002;private _keypadObj=cursorObject;if!([_enteredKey]call life_fnc_isAlphanumeric) exitWith{["Enter a real number/letter!","basic"]spawn life_fnc_handleMessage;};if(player distance2D _churchObj>150) exitWith{};if!((typeOf _keypadObj) isEqualTo"Land_Tablet_01_F") exitWith{};if(_enteredKey isEqualTo(SRV_mentalAsylumData param[3,""])) then{private _toSend=(allPlayers-[allDeadMen]) select{(_x distance player)<=35};[[_churchObj,"bombarm"],"life_fnc_playSound",_toSend]spawn life_fnc_MP;["You have unlocked the tomb to the patient!","basic"]spawn life_fnc_handleMessage;_keypadObj setVariable["ga_mentalUnlockedTomb",true,true];};};case("copStartBuryPatientRemains"):{private _keypadObj=cursorObject;private _churchObj=nearestObject[(getMarkerPos"life_mentalHospitalPatient"),"Land_Church_05_F"];if(life_action_in_use) exitWith{};if!(playerSide isEqualTo west) exitWith{};if(player distance2D _churchObj>150) exitWith{};if!((typeOf _keypadObj) isEqualTo"Land_Tablet_01_F") exitWith{};if(_keypadObj getVariable["ga_buryInProgress",-1]!=-1) exitWith{["The bury process has already started","basic"]spawn life_fnc_handleMessage;};disableSerialization;5 cutRsc["life_progress","PLAIN"];private _display=uiNameSpace getVariable["life_progress",displayNull];private _progressBar=_display displayCtrl 38201;private _progressText=_display displayCtrl 38202;life_action_in_use=true;private _increment=1;private _totalTime=15;private _currentPoint=0;private _loopDelay=_totalTime/floor(100/_increment);private _text=format["Starting the bury process"];private _startCount=0;_progressBar progressSetPosition _startCount;_progressText ctrlSetText format["%1 (%2%3)",_text,_startCount,"%"];[["Acts_TerminalOpen",_totalTime,"switchMove",player],"life_fnc_handleAnim",(allPlayers select{(_x distance player)<=100})]spawn life_fnc_MP;private _isSuccess=for"_i"from 0 to 1 step 0 do{uiSleep _loopDelay;if(isNull _progressBar) exitWith{["You have failed to start the bury process","basic"]spawn life_fnc_handleMessage;false};_currentPoint=(progressPosition _progressBar)+(_increment/100);_progressBar progressSetPosition _currentPoint;_progressText ctrlSetText format["%1 (%2%3)",_text,round(_currentPoint*100),"%"];if(_currentPoint>=1) exitWith{true};if((speed player)>=3) exitWith{["You have failed to start the bury process","basic"]spawn life_fnc_handleMessage;false};if!(isNull objectParent player) exitWith{["You have failed to start the bury process","basic"]spawn life_fnc_handleMessage;false};if(!life_action_in_use||!alive player) exitWith{["You have failed to start the bury process","basic"]spawn life_fnc_handleMessage;false};false;};["",0,"switchMove",player]spawn life_fnc_handleAnim;life_action_in_use=false;5 cutText["","PLAIN"];if!(_isSuccess) exitWith{["You have failed to start the bury process","basic"]spawn life_fnc_handleMessage;};_keypadObj setVariable["ga_buryInProgress",serverTime,true];};case("civStopBuryPatientRemains"):{private _keypadObj=cursorObject;private _churchObj=nearestObject[(getMarkerPos"life_mentalHospitalPatient"),"Land_Church_05_F"];if(life_action_in_use) exitWith{};if!(playerSide isEqualTo civilian) exitWith{};if(player distance2D _churchObj>150) exitWith{};if!((typeOf _keypadObj) isEqualTo"Land_Tablet_01_F") exitWith{};if(_keypadObj getVariable["ga_buryInProgress",-1]==-1) exitWith{["The bury process has not started","basic"]spawn life_fnc_handleMessage;};disableSerialization;5 cutRsc["life_progress","PLAIN"];private _display=uiNameSpace getVariable["life_progress",displayNull];private _progressBar=_display displayCtrl 38201;private _progressText=_display displayCtrl 38202;life_action_in_use=true;private _increment=1;private _totalTime=15;private _currentPoint=0;private _loopDelay=_totalTime/floor(100/_increment);private _text=format["Stopping the bury process"];private _startCount=0;_progressBar progressSetPosition _startCount;_progressText ctrlSetText format["%1 (%2%3)",_text,_startCount,"%"];[["Acts_TerminalOpen",_totalTime,"switchMove",player],"life_fnc_handleAnim",(allPlayers select{(_x distance player)<=100})]spawn life_fnc_MP;private _isSuccess=for"_i"from 0 to 1 step 0 do{uiSleep _loopDelay;if(isNull _progressBar) exitWith{["You have failed to stop the bury process","basic"]spawn life_fnc_handleMessage;false};_currentPoint=(progressPosition _progressBar)+(_increment/100);_progressBar progressSetPosition _currentPoint;_progressText ctrlSetText format["%1 (%2%3)",_text,round(_currentPoint*100),"%"];if(_currentPoint>=1) exitWith{true};if((speed player)>=3) exitWith{["You have failed to stop the bury process","basic"]spawn life_fnc_handleMessage;false};if!(isNull objectParent player) exitWith{["You have failed to stop the bury process","basic"]spawn life_fnc_handleMessage;false};if(!life_action_in_use||!alive player) exitWith{["You have failed to stop the bury process","basic"]spawn life_fnc_handleMessage;false};false;};["",0,"switchMove",player]spawn life_fnc_handleAnim;life_action_in_use=false;5 cutText["","PLAIN"];if!(_isSuccess) exitWith{["You have failed to stop the bury process","basic"]spawn life_fnc_handleMessage;};[[format["The rebels have stopped the bury process, go back there and restart it!"],"warning"],"life_fnc_handleMessage",west]spawn life_fnc_MP;_keypadObj setVariable["ga_buryInProgress",-1,true];};case("lootPatientsRemains"):{_mentalData params[["_remainsObject",objNull,[objNull]]];if(SRV_mentalAsylumData param[4,false]) exitWith{["You must unlock the tomb with a code at the door!","basic"]spawn life_fnc_handleMessage;};if!(_remainsObject isEqualTo(SRV_mentalAsylumData param[5,objnull])) exitWith{};if(_remainsObject getVariable["ga_remainsGathered",false]) exitWith{};if(isNull _remainsObject) exitWith{};if([true,"patientbag",3]call life_fnc_handleInv) then{_remainsObject setVariable["ga_remainsGathered",true,true];deleteVehicle _remainsObject;["Sell these patient remains at a nearby rebel!","basic"]spawn life_fnc_handleMessage;}else{["You do not have room to grab the patients loot!","basic"]spawn life_fnc_handleMessage;};};};