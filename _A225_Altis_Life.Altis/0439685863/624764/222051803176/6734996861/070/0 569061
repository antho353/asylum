};if(isEngineOn _vehicle) exitWith{titleText["You cannot turn the vehicle on when mining","PLAIN"];};if!(player isEqualTo(_vehicle getVariable["ga_mining",objNull])) exitWith{["You can only have one device running at a time","basic"]spawn life_fnc_handleMessage;};titleText["The Device is gathering...","PLAIN"];_time=time+_timeDelay;waitUntil{if(isEngineOn _vehicle) exitWith{titleText["You cannot turn the vehicle on when mining","PLAIN"];true};if(player distance _vehicle>10) exitWith{true};if(round(_time-time)<1) exitWith{true};uiSleep 0.2;false };if(isEngineOn _vehicle) exitWith{titleText["You cannot turn the vehicle on when mining","PLAIN"];};if(player distance _vehicle>10) exitWith{["You must stay near the vehicle.","basic"]spawn life_fnc_handleMessage;};private _vehInv=_vehicle getVariable["ga_vinv",[[],0]];_vehInv params["_items","_weight"];_sum=[_item,_amountPerCycle,_weight,_maxWeight]call life_fnc_calWeightDiff;if(_sum<1) exitWith{titleText["The vehicle is full","PLAIN"];};_itemWeight=((["getItemWeight",_item]call life_fnc_virtItemCfg)*_sum);_index=_items findIf{(_x select 0) isEqualTo _item};if(_index isEqualTo-1) then{_items pushBack[_item,_sum];}else{private _oldVal=(_items select _index) select 1;(_items select _index) set[1,_oldVal+_sum];};if(fuel _vehicle isEqualTo 0) exitWith{titleText["The vehicle is out of fuel.","PLAIN"];};if(local _vehicle) then{_vehicle setFuel((fuel _vehicle)-0.02);}else{[[_vehicle,(fuel _vehicle)-0.02],"life_fnc_setFuel",_vehicle,false]spawn life_fnc_MP;};if(fuel _vehicle isEqualTo 0) exitWith{titleText["Vehicle is out of fuel","PLAIN"];};if!(player isEqualTo(_vehicle getVariable["ga_mining",objNull])) exitWith{["You can only have one device running at a time","basic"]spawn life_fnc_handleMessage;};titleText[format["Completed cycle, the device has mined %1 %2",_sum,["getName",_item]call life_fnc_virtItemCfg],"PLAIN"];[_item,_sum]call life_fnc_statArrUpdate;_totalGathered=_totalGathered+_sum;_vehicle setVariable["ga_vinv",[_items,_weight+_itemWeight],true];_sum=[_item,_amountPerCycle,_weight+_itemWeight,_maxWeight]call life_fnc_calWeightDiff;if(_sum<1) exitWith{titleText["The vehicle is full","PLAIN DOWN"];};uiSleep 2;};if((_totalGathered isNotEqualTo 0)&&(_dbInfo isNotEqualTo[])) then{_dbInfo params["_ownerPID","_plate"];_keychainUIDs=(_vehicle getVariable["ga_vehOwners",[]]);[["-GATHERDEVICE-",player,profileName,format["gathered %1 %2 with a tempest device at position %3. Plate: %4. OwnerUID: %5. Keychain: %6",_totalGathered,["getName",_item]call life_fnc_virtItemCfg,getPosATL player,_plate,_ownerPID,_keychainUIDs]],"TON_fnc_logIt",2]spawn life_fnc_MP;};if!(player isEqualTo(_vehicle getVariable["ga_mining",objNull])) exitWith{};_vehicle setVariable["ga_mining",objNull,true];