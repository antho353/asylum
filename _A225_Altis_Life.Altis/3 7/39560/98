#include"..\..\macro.h"
if(scriptAvailable(3)) exitWith{["Wait a bit before attempting to revive again!","basic"]spawn life_fnc_handleMessage;};if((life_cashCache!=((life_cash/4)+7))||(life_atmcashCache!=((life_atmcash/4)+5))) exitWith{[["-HACKEDMONEY-",player,profileName,format["File: %1 - money tampering attempted! Cash: %2 - Expected cash: %3 | Bank: %4 - Expected bank: %5.",_fnc_scriptName,[life_cash]call life_fnc_numberText,[((life_cashCache-7)*4)]call life_fnc_numberText,[life_atmCash]call life_fnc_numberText,[((life_atmCashCache-5)*4)]call life_fnc_numberText]],"TON_fnc_logIt",2]spawn life_fnc_MP;[[profileName,"Attempting to hack money variable."],"life_fnc_notifyAdmins",-2,false]spawn life_fnc_MP;["MemHackCash",false,false]call compile PreProcessFileLineNumbers"\a3\functions_f\Misc\fn_endMission.sqf";};private _target=cursorObject;if(isNull _target||!(_target isKindOf"CAManBase")||life_action_in_use) exitWith{};private _revivable=_target getVariable["ga_revivable",false]||((_target getVariable["ga_group",grpNull]isEqualTo group player)&&!(isNull(_target getVariable["ga_group",grpNull])));if!(_revivable) exitWith{};if(_target getVariable["ga_reviving",player]!=player) exitWith{["Someone else is already reviving this person","basic"]spawn life_fnc_handleMessage;};if(player distance _target>5||!(isNull objectParent player)) exitWith{};if(isWeaponDeployed player) then{player playMove"";};if(time<(player getVariable["ga_next_revive",-1000])) exitWith{[format["You cannot revive someone so soon after being revived yourself. You must wait %1 seconds.",round((player getVariable["ga_next_revive",-1000])-time)],"basic"]spawn life_fnc_handleMessage;};if(playerSide isEqualTo civilian&&(time<(profileNamespace getVariable["ga_recent_revive",[0,0]]select 1))) exitWith{[format["You have recently revived someone! Your defibrillators need time to recharge! They should be ready in %1 seconds.",(profileNamespace getVariable["ga_recent_revive",[0,0]]select 1)-time],"basic"]spawn life_fnc_handleMessage;};if(time<(_target getVariable["ga_next_revive",-1000])&&!(call life_medicLevel>=5||(call life_copLevel>=6&&life_coprole in["all","medic"]&&22 in life_cop_talents))) exitWith{[format["The victim was recently revived and cannot be revived again for %1 seconds.",(_target getVariable["ga_next_revive",-1000])-time],"basic"]spawn life_fnc_handleMessage;};private _targetName=_target getVariable["ga_name","Unknown"];private _text=format["Reviving %1",_targetName];life_action_in_use=true;_target setVariable["ga_reviving",player,true];disableSerialization;5 cutRsc["life_progress","PLAIN"];private _ui=uiNamespace getVariable"life_progress";private _progress=_ui displayCtrl 38201;private _pgText=_ui displayCtrl 38202;_pgText ctrlSetText format["%2 (1%1)...","%",_text];_progress progressSetPosition 0.01;private _cP=0.01;private _success=false;private _sleep=switch(true) do{case(120 in life_side_talents&&call(life_medicLevel)>=4):{0.1};case(playerSide isEqualTo independent):{0.15};case(life_coprole in["all","medic"]&&{18 in life_cop_talents}):{0.15};case(life_coprole in["all","detective"]&&{33 in life_cop_talents}):{0.15};default{0.2};};if(playerSide isEqualTo civilian&&458 in life_completedLifetimeQuests) then{_sleep=_sleep*0.15;};["AinvPknlMstpSnonWnonDr_medic0",9]spawn life_fnc_handleAnim;for"_i"from 0 to 1 step 0 do{uiSleep _sleep;_cP=_cP+0.01;_progress progressSetPosition _cP;_pgText ctrlSetText format["%3 (%1%2)...",round(_cP*100),"%",_text];_revivable=_target getVariable["ga_revivable",false]||((_target getVariable["ga_group",grpNull]isEqualTo group player)&&!(isNull(_target getVariable["ga_group",grpNull])));