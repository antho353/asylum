};};if(_spawnPoint isEqualTo"") exitWith{["There is a vehicle currently blocking the spawn point(s).","basic"]spawn life_fnc_handleMessage;};private _success=false;if(_bloodMoneyBuy) then{_price=_price*(["vehshop",true]call life_fnc_getDiscount);if(life_bloodMoney<_price) exitWith{[format["You cannot afford this item. You need %1 BM",[_price]call life_fnc_numberText],"basic"]spawn life_fnc_handleMessage;};life_bloodMoney=life_bloodMoney-_price;_success=true;}else{if(_classname isEqualTo"C_Hatchback_01_sport_F"&&playerSide isEqualTo west&&656 in life_completedLifetimeQuests) then{_price=_price*0.05;};if(_classname isKindOf"Air"&&playerSide in[west,independent]&&(657 in life_completedLifetimeQuests)||(809 in life_completedLifetimeQuests)) then{_price=_price*0.02;};if(_classname isKindOf"Land"&&playerSide isEqualTo independent&&808 in life_completedLifetimeQuests) then{_price=_price*0.02;};if(_classname in["MRAP_01","MRAP_02","MRAP_03"]&&playerSide isEqualTo west&&658 in life_completedLifetimeQuests) then{_price=_price*0.02;};_price=if(_isSwat||_isFirefighter) then{0}else{_price*(["vehshop",true]call life_fnc_getDiscount);};if!([_price]call life_fnc_debitCard) exitWith{};_success=true;if(_classname isKindOf"Land") then{["buy","invehiclevalue",_price]call life_fnc_handleQuest;};if(_classname isKindOf"Air") then{["buy","inaircraftvalue",_price]call life_fnc_handleQuest;};if(_classname isEqualTo"C_Hatchback_01_sport_F") then{["buy","inhatchbackvalue",_price]call life_fnc_handleQuest;};if(_classname in["MRAP_01","MRAP_02","MRAP_03"]) then{["buy","inarmorvalue",_price]call life_fnc_handleQuest;};};if!(_success) exitWith{};if(playerSide isEqualTo independent) then{["buy","vehicle",1]spawn life_fnc_handleQuest;};if(_bloodMoneyBuy) then{[18]call life_fnc_ClupdatePartial;}else{[6]call life_fnc_ClupdatePartial;};private _markerPos=if(_spawnPoint isEqualType objNull) then{getPosATL _spawnPoint}else{getMarkerPos _spawnPoint};_markerPos set[2,(_markerPos select 2)+1.5];private _vehicle=createVehicle[_classname,[random 999,random 999,999],[],0,"CAN_COLLIDE"];waitUntil{!isNil"_vehicle"&&{!isNull _vehicle}};_vehicle lock true;_vehicle allowDamage false;if(_spawnPoint isEqualType objNull) then{_vehicle setDir([((direction _spawnPoint)-90),direction _spawnPoint]select("VR"in typeOf _spawnPoint))}else{_vehicle setDir(markerDir _spawnPoint)};if(_spawnPoint in[civ_air_carrier_1,civ_air_carrier_2,civ_air_carrier_3]) then{_vehicle setPosATL _markerPos}else{_vehicle setPos _markerPos};_vehicle setVectorUp(surfaceNormal _markerPos);private _tax=if(!(_bloodMoneyBuy)&&!(_shopVar in["reb_car","blood_car"])) then{(_price*(call life_fnc_getGovTax))}else{0};private _extra=if(!(_bloodMoneyBuy)&&!(_shopVar in["reb_car","blood_car"])) then{format[", including a tax of $%1",[_tax]call life_fnc_numberText]}else{""};playSound"purchase";if(_bloodMoneyBuy) then{[format["You bought a %1 for %2 BM. Press U while looking at the vehicle to unlock it or relock it.",getText(configFile>>"CfgVehicles">>_className>>"displayName"),[_price]call life_fnc_numberText],"basic"]spawn life_fnc_handleMessage;}else{[format["You bought a %1 for $%2%3. Press U while looking at the vehicle to unlock it or relock it.",getText(configFile>>"CfgVehicles">>_className>>"displayName"),[_price]call life_fnc_numberText,_extra],"basic"]spawn life_fnc_handleMessage;["payGovernor",[_tax]]spawn life_fnc_govSystem;};closeDialog 0;if((call life_fnc_isDominationActive)&&([player]call life_fnc_inDomSafezone)&&((call life_adminLevel)<3)) then{life_dominationPotCache=life_dominationPotCache+_price;[format["This purchase has added $%1 to the Domination event prize pool!",[_price]call life_fnc_numberText]]spawn life_fnc_handleMessage;};private _rebelOutposts=["Rebelop_1","Rebelop_2","Rebelop_3","Rebelop_4","Rebelop_5","Rebelop_6"];if!(({player distance(getMarkerPos _x)<=200}count _rebelOutposts) isEqualTo 0) then{["moneyspentrebel",_price]call life_fnc_statArrUpdate;};["vehiclesbought",1]call life_fnc_statArrUpdate;[_vehicle]call life_fnc_clearVehicleAmmo;clearItemCargoGlobal _vehicle;clearBackpackCargoGlobal _vehicle;uiSleep 1;private _mods=if(_alarm isEqualTo 1||(playerSide isEqualTo west&&91 in life_side_talents)) then{[1,0,0,0]}else{[0,0,0,0]};private _side=[]call life_fnc_sideString;[_vehicle,_mods,_skinID,"",[0,0.5],_isSwat,false,_isFirefighter,_isSRT]spawn life_fnc_prepareVehicle;[[player,_vehicle,getPlayerUID player,_side,_skinID,_alarm,_isSwat,_isFirefighter,_isSRT],"TON_fnc_vehicleCreate",2]spawn life_fnc_MP;