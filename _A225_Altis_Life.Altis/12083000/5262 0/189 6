#include"..\..\macro.h"
private["_diff","_mods","_trunk","_itemClass"];disableSerialization;if(isNull life_trunk_vehicle||!alive life_trunk_vehicle) exitWith{};if(!alive player) exitwith{closeDialog 0;};if(life_is_virtual) exitWith{closeDialog 0;};if((lbCurSel 4502) isEqualTo-1) exitWith{["You did not select anything.","basic"]spawn life_fnc_handleMessage;};private _fnc_updatePhysicalTrunk={params["_trunkObj","_items"];private _weight=_items call life_fnc_physicalInventoryWeight;_trunkObj setVariable["ga_pinv",[_items,_weight],true];};private _trunkItemSelected=getSelData(4502);private _quantity=ctrlText 4505;if(_trunkItemSelected isEqualTo"") exitWith{["You didn't select anything.","basic"]spawn life_fnc_handleMessage;};if(!([_quantity]call life_fnc_isNumber)) exitWith{["Invalid Number format.","basic"]spawn life_fnc_handleMessage;};_quantity=parseNumber(_quantity);if((_quantity isEqualTo 0)&&(playerSide isEqualTo civilian)) exitWith{["You need to enter an amount to take!","basic"]spawn life_fnc_handleMessage;};if((_quantity<1)&&(playerSide isEqualTo civilian)) exitWith{["You can't enter anything below one!","basic"]spawn life_fnc_handleMessage;};private _vehPos=getPos life_trunk_vehicle;private _playerPos=getPos player;if(_vehPos distance _playerPos>10) exitWith{closeDialog 0;["You are too far away!","basic"]spawn life_fnc_handleMessage;};life_inventoryInteraction=true;private _data=life_trunk_vehicle getVariable["ga_pinv",[[],0]];private _inv=_data select 0;private _currentWeight=_data select 1;private _weight=getNumber(missionConfigFile>>"CfgWeights">>(_trunkItemSelected)>>"weight");_itemClass=([_trunkItemSelected]call BIS_fnc_itemType) select 1;private _maxValue=lbValue[4502,(lbCurSel 4502)];private _pilotHelms=["H_PilotHelmetFighter_B","H_PilotHelmetFighter_O","H_PilotHelmetFighter_I"];if(_quantity>_maxValue) then{_quantity=_maxValue};private _fnc_adjustArray={params["_item","_array"];private _index=-1;{if!(_index isEqualTo-1) exitWith{};if(_item isEqualTo(_x select 0)) exitWith{_index=_forEachIndex;};}forEach _array;if(_index isEqualTo-1) exitWith{};if(((_array select _index) select 1)>1) then{_array set[_index,[_item,((_array select _index) select 1)-1]];}else{_array set[_index,-1];};_array=_array-[-1];_array;};private _fnc_dropItem={params[["_classname","",[""]],["_count",0,[0]],["_playertarget",objNull,[objNull]],["_player",objNull,[objNull]],["_holder",objNull,[objNull]]];