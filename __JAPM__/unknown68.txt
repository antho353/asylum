life_didServerRespond=false;private _maxDelayTime=time+5;[[player],"TON_fnc_lagCheck",2]spawn life_fnc_MP;waitUntil{time>_maxDelayTime||life_didServerRespond};if(time>_maxDelayTime) exitWith{closeDialog 0;["Menu failed, try again.","basic"]spawn life_fnc_handleMessage;if(_obj getVariable["ga_inUse",objNull]isEqualTo player) then{_obj setVariable["ga_inUse",nil,true]};};_pickupButton ctrlEnable true;private _items=_obj getVariable["ga_droppedItems",[]];life_pickMenuItems=+_items;{_x params["_itemShortName","_itemAmount"];private _text=if(_itemShortName isEqualTo"money") then{format["$%1 Cash",[_itemAmount]call life_fnc_numberText];}else{format["%1x %2",_itemAmount,["getName",_itemShortName]call life_fnc_virtItemCfg];};private _index=_itemList lbAdd _text;_itemList lbSetData[_index,format["['%1', %2]",_itemShortName,_itemAmount]];_itemList lbSetPicture[_index,["getIcon",_itemShortName]call life_fnc_virtItemCfg];}forEach life_pickMenuItems;waitUntil{isNull _display};if!(isNull _obj) then{uiSleep 0.1;_obj setVariable["ga_inUse",nil,true];if(life_pickMenuItems isNotEqualTo _items) then{_obj setVariable["ga_droppedItems",life_pickMenuItems,true];};};