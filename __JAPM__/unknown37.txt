};if(isNull _selectedPlayer) exitWith{["Please select a player from the list.","basic"]spawn life_fnc_handleMessage;};private _selectedPlayerName=_selectedPlayer getVariable["ga_name",[name _selectedPlayer]call life_fnc_cleanName];private _uid=getPlayerUID _selectedPlayer;if(_uid in _keyPlayers) exitWith{[format["%1 already has a key to this property.",_selectedPlayerName],"basic"]spawn life_fnc_handleMessage;};_keyholders pushBack[_uid,_chosenRank,_selectedPlayerName];_displayRank=switch(_chosenRank) do{case(1):{"Both"};case(2):{"Inv"};case(3):{"Keys"};};[format["You have given %1 a special key to your building.",_selectedPlayerName]]spawn life_fnc_handleMessage;[[_bldg,_keyholders,player],"TON_fnc_bldgUpdateKeys",2]spawn life_fnc_MP;_bldg setVariable["ga_activeTrunk",nil,true];};case 2:{private _keyPlayers=_bldg getVariable["ga_house_keys",[]];if(_keyPlayers isEqualTo[]) exitWith{["No one currently has keys to this property.","basic"]spawn life_fnc_handleMessage;};[[_bldg,[],player],"TON_fnc_bldgUpdateKeys",2]spawn life_fnc_MP;["You have changed the locks to the building. All previous building keys will no longer work on the locks.","basic"]spawn life_fnc_handleMessage;};case 3:{private _keyholders=_bldg getVariable["ga_house_keys",[]];private _keyPlayers=[_bldg,"","getKeyHolders"]call life_fnc_keyHolderStatus;private _display=findDisplay 37500;private _bldgKeyholders=_display displayCtrl 37502;if(lbCurSel _bldgKeyholders isEqualTo-1) exitWith{};(parseSimpleArray(_bldgKeyholders lbData(lbCurSel _bldgKeyholders))) params[["_removePlayerUID","",[""]],["_removeRank",-1,[0]],["_removePlayerName","",[""]]];if(_removePlayerUID isEqualTo"") exitWith{};private _findIDX=_keyholders findIf{_removePlayerUID isEqualTo(_x param[0,""])};if!(_removePlayerUID in _keyPlayers) exitWith{["The selected player no longer has keys to this building.","basic"]spawn life_fnc_handleMessage;};_keyholders deleteAt _findIDX;[format["You have removed access to this building from %1.",_removePlayerName]]spawn life_fnc_handleMessage;[[_bldg,_keyholders,player],"TON_fnc_bldgUpdateKeys",2]spawn life_fnc_MP;};case 4:{closeDialog 0;if(life_action_in_use||life_houseTxn) exitWith{["You already attempting an upgrade on your house.","basic"]spawn life_fnc_handleMessage;};private _keyCapCount=_bldg getVariable["ga_keycap",0];if(_keyCapCount>=life_maxHouseKeys) exitWith{["You already have the max amount of spare keys created.","basic"]spawn life_fnc_handleMessage;};private _keyholders=_bldg getVariable["ga_house_keys",[]];private _availableKeys=_keyCapCount-(count _keyholders);private _upgradeCost=life_keyUpgradeCosts select _keyCapCount;private _action=[format["Would you like to create an additonal house key for $%1",[_upgradeCost]call life_fnc_numberText],"Create Additional house Key","Create Key","Cancel"]call BIS_fnc_guiMessage;if!(_action) exitWith{["You have decided not to create an additional house key.","basic"]spawn life_fnc_handleMessage;};if(_action) then{private _houseID=_bldg getVariable["ga_houseID",-1];if(_houseID isEqualTo-1) exitWith{["An error has occured. Please try again.","basic"]spawn life_fnc_handleMessage;};if(_upgradeCost>life_cash&&_upgradeCost>life_atmcash) exitWith{[format["You do not have $%1 on-hand or in your bank to upgrade your property.",[_upgradeCost]call life_fnc_numberText],"basic"]spawn life_fnc_handleMessage;};life_houseTxn=true;life_action_in_use=true;if(life_cash>=_upgradeCost) then{life_cash=life_cash-_upgradeCost;life_cashCache=((life_cash/4)+7);}else{life_atmcash=life_atmcash-_upgradeCost;life_atmcashCache=((life_atmcash/4)+5);};[6]call life_fnc_ClupdatePartial;[[_bldg,player,"spareKey",_keyCapCount,_houseID],"TON_fnc_updateProperty",2]spawn life_fnc_MP;["Creating an additional key for your house...","basic"]spawn life_fnc_handleMessage;};};};