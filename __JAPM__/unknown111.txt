params[["_zone","",[""]]];private _zoneLocation=getMarkerPos format["%1_cartel",_zone];private _flagObject=missionNamespace getVariable format["%1_flag",_zone];if(isNil{player getVariable"gang_data"}) then{player setVariable["gang_data",life_gang_data,true];};if(ASY_Server isEqualTo 2) exitWith{["This action is currently disabled on Server 2.","basic"]spawn life_fnc_handleMessage;};if(_zone isEqualTo""||life_capturingCartel||(isNil"_flagObject"||isNull _flagObject)||(player getVariable["ga_restrained",false])||!(isNull objectParent player)||(eyePos player select 2<0.3)) exitWith{};if(!license_civ_rebel||player getVariable["ga_isBountyHunter",false]) exitWith{};life_capturingCartel=true;player setVariable["ga_cartCap",true,true];private _captureData=_flagObject getVariable["ga_capData",[0,"Neutral",0.5]];private _zoneName=switch(_zone) do{case"arms":{"Arms Dealer"};case"drug":{"Drug Cartel"};case"oil":{"Oil Cartel"};case"wongs":{"Wong Triad"};default{""};};private _playersGangID=life_gang_data select 0;private _playerGangName=life_gang_data select 1;private _playerGroupMembers=units group player;private _isLeader=player isEqualTo(leader(group player));private _nonGangGroup=((_playerGroupMembers findIf{(_x getVariable["gang_data",[0]]param[0,0]) isNotEqualTo _playersGangID}) isNotEqualTo-1);if(_nonGangGroup&&!_isLeader) exitWith{life_capturingCartel=false;if(player getVariable["ga_cartCap",false]) then{player setVariable["ga_cartCap",true,true];};[format["This %1 is being captured for %2's gang!",_zoneName,name(leader(group player))]]spawn life_fnc_handleMessage;};disableSerialization;5 cutRsc["life_progress","PLAIN"];private _cpRate=0;private _ui=uiNamespace getVariable"life_progress";private _progressBar=_ui displayCtrl 38201;private _titleText=_ui displayCtrl 38202;private _title=format["You have entered the %1 zone.",_zoneName];_titleText ctrlSetText _title;private _currentCaptureProgress=((round((_captureData select 2)*3000))/3000);_progressBar progressSetPosition _currentCaptureProgress;private _cP=_currentCaptureProgress;private _updateTime=time+10;while{true}do{if!(alive player) exitWith{};if([getPos player select 0,getPos player select 1,0]distance2D _zoneLocation>50) exitWith{};if!(life_capturingCartel) exitWith{};if(player getVariable["ga_restrained",false]) exitWith{};if!(isNull objectParent player) exitWith{};if(isNull _ui) then{5 cutRsc["life_progress","PLAIN"];_ui=uiNamespace getVariable"life_progress";_progressBar=_ui displayCtrl 38201;_titleText=_ui displayCtrl 38202;};uiSleep 1;_captureData=_flagObject getVariable["ga_capData",[0,"Neutral",0.5]];_captureData params["_currentDataID","_currentGangName"];_currentCaptureProgress=((round((_captureData select 2)*3000))/3000);private _cartelMarker=format["%1_cartel",_zone];private _cartelMarkerText=markerText _cartelMarker;private _newCartelMarkerText=_cartelMarkerText;private _nearbyPlayers=(_zoneLocation nearEntities[["CAManBase"],60]) select{isPlayer _x&&isNull objectParent _x&&side _x isEqualTo civilian&&alive _x&&!(_x getVariable["gang_data",[0]]isEqualTo 0)&&!(toLower(primaryWeapon _x) in life_nonCartelGuns) &&_x getVariable["ga_cartCap",false]&&!(_x getVariable["ga_isBountyHunter",false]) };private _nearbyGangs=[];{_nearbyGangs pushBackUnique(_x getVariable["gang_data",[0]]select 0);}forEach _nearbyPlayers;private _playerGroupMembers=units group player;private _isLeader=player isEqualTo(leader(group player));private _nonGangGroup=((_playerGroupMembers findIf{(_x getVariable["gang_data",[0]]param[0,0]) isNotEqualTo _playersGangID}) isNotEqualTo-1);private _groupGangIDs=_playerGroupMembers apply{_x getVariable["gang_data",[0]]param[0,0]};private _isContested=((_nearbyGangs findIf{(_x isNotEqualTo-1)&&!(_x in _groupGangIDs)}) isNotEqualTo-1);if(!_isLeader&&_nonGangGroup) exitWith{life_capturingCartel=false;if(player getVariable["ga_cartCap",false]) then{player setVariable["ga_cartCap",true,true];};[format["This %1 is being captured for %2's gang!",_zoneName,name(leader(group player))]]spawn life_fnc_handleMessage;};private _upCappedButNotCappedFully=(_currentDataID isEqualTo _playersGangID&&_currentCaptureProgress<1);private _notOwnedByUs=(_currentDataID isNotEqualTo _playersGangID);private _onlyUsInRadius=(((count _nearbyGangs) isEqualTo 1)&&((_nearbyGangs param[0,0]) isEqualTo(_playersGangID)));if((_upCappedButNotCappedFully||_notOwnedByUs)&&(_onlyUsInRadius||(_nonGangGroup&&!_isContested))) then{if(serverTime<(_flagObject getVariable["ga_capture_cooldown",serverTime-100])) exitWith{_title=format["Capture cooldown - %1 + minutes remaining.",round(((_flagObject getVariable["ga_capture_cooldown",serverTime-100])-serverTime)/60)];